<div class="header-breadcrumbs">
    <h1><i class="fa fa-users"></i> Connections</h1>
</div>

<clr-tabs>
    <!-- Accepted connections tab -->
    <clr-tab>
        <button id="accepted-connection-tab" clrTabLink (click)="resetForm()">
            <i class="fa fa-check"></i>
            <span>Accepted</span>
        </button>
        <clr-tab-content *clrIfActive="isAcceptedConnectionDisplayed">
            <section class="form-block">
                <clr-datagrid>
                    <clr-dg-column mltag="txt_action">Actions</clr-dg-column>
                    <clr-dg-column [clrDgField]="'connections'">Connection</clr-dg-column>
                    <clr-dg-column [clrDgField]="'subportfolios'">Subportfolio</clr-dg-column>

                    <clr-dg-row *clrDgItems="let acceptedConnection of acceptedConnectionList">
                        <clr-dg-cell>
                            <div class="btn-group btn-sm">
                                <button id="edit-button" class="btn" (click)="handleEdit(acceptedConnection)">
                                    <i class="fa fa-edit"></i>
                                </button>
                                <button id="delete-button" class="btn"
                                        (click)="connectionToDelete = acceptedConnection; isModalDisplayed = true;">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </clr-dg-cell>
                        <clr-dg-cell>{{acceptedConnection.connection}}</clr-dg-cell>
                        <clr-dg-cell>{{acceptedConnection.subPortfolio}}</clr-dg-cell>
                    </clr-dg-row>

                    <clr-dg-footer>
                        {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
                        <clr-dg-pagination #pagination [clrDgPageSize]="10"></clr-dg-pagination>
                    </clr-dg-footer>
                </clr-datagrid>
            </section>
        </clr-tab-content>
    </clr-tab>

    <!-- Pending connections tab -->
    <clr-tab>
        <button id="pending-connection-tab" clrTabLink (click)="resetForm()">
            <i class="fa fa-ellipsis-h"></i>
            <span>Pending</span>
        </button>
        <clr-tab-content>
            <section class="form-block">
                <clr-datagrid>
                    <clr-dg-column [clrDgField]="'connections'">Connection</clr-dg-column>
                    <clr-dg-column mltag="txt_action">Actions</clr-dg-column>

                    <clr-dg-row *clrDgItems="let pendingConnection of pendingConnectionList">
                        <clr-dg-cell>{{pendingConnection.connection}}</clr-dg-cell>
                        <clr-dg-cell>
                            <div class="btn-group">
                                <button id="accept-connection-button" class="btn btn-success"
                                        (click)="connectionToBind = pendingConnection; isAcceptModalDisplayed = true;">
                                    Accept
                                </button>
                            </div>
                            <div class="btn-group">
                                <button id="reject-connection-button" class="btn btn-danger"
                                        (click)="handleRejectConnection(pendingConnection)">
                                    Reject
                                </button>
                            </div>
                        </clr-dg-cell>
                    </clr-dg-row>

                    <clr-dg-footer>
                        {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
                        <clr-dg-pagination #pagination [clrDgPageSize]="10"></clr-dg-pagination>
                    </clr-dg-footer>
                </clr-datagrid>
            </section>
        </clr-tab-content>
    </clr-tab>

    <!-- Add or edit connection tab -->
    <clr-tab>
        <div *ngIf="!isEditFormDisplayed; else editConnectionForm">
            <button id="add-connection-tab" clrTabLink (click)="resetForm()">
                <i class="fa fa-plus"></i>
                <span>Add a connection</span>
            </button>
        </div>

        <ng-template #editConnectionForm>
            <button id="edit-connection-tab" clrTabLink>
                <i class="fa fa-pencil"></i>
                <span>Edit a connection</span>
            </button>
        </ng-template>

        <clr-tab-content *clrIfActive="isEditFormDisplayed">
            <form [formGroup]="formGroup" novalidate (ngSubmit)="handleSubmit()">
                <section class="form-block">
                    <div class="row">
                        <div class="form-group col-sm-6">
                            <label class="control-label">
                                <span>Connection's name</span>
                            </label>
                            <ng-select
                                    id="add-connection-select"
                                    placeholder="Select a connection"
                                    [items]="walletList"
                                    [allowClear]=true
                                    [formControl]="formGroup.controls['connection']"
                                    [disabled]="isEditFormDisplayed">
                            </ng-select>
                            <span class="mandatory-field">*</span>
                            <div *ngIf="formGroup.controls['connection'].hasError('required') && formGroup.controls['connection'].touched"
                                 class="text-danger">This field is required
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group col-sm-6">
                            <label class="control-label">
                                <span>Sub-portfolio's name</span>
                            </label>
                            <ng-select
                                    id="add-sub-portfolio-select"
                                    [items]="addressList"
                                    [allowClear]=true
                                    placeholder="Select a sub-portfolio"
                                    [formControl]="formGroup.controls['sub-portfolio']">
                            </ng-select>
                            <span class="mandatory-field">*</span>
                            <div *ngIf="formGroup.controls['sub-portfolio'].hasError('required') && formGroup.controls['sub-portfolio'].touched"
                                 class="text-danger">This field is required
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <button id="connection-submit-btn" class="btn btn-primary" [disabled]="formGroup.invalid">
                            <i class="fa fa-save"></i>
                            <span class="ml_translated" mltag="txt_save">Save</span>
                        </button>
                    </div>
                </section>
            </form>
        </clr-tab-content>
    </clr-tab>
</clr-tabs>

<!-- Delete confirmation modal -->
<clr-modal [(clrModalOpen)]="isModalDisplayed">
    <h3 class="modal-title">Delete a connection</h3>
    <div class="modal-body">
        <p mltag="txt_areyousure">Are you sure you want to delete:<br/>
            <strong>{{connectionToDelete && connectionToDelete.connection}}</strong>
        </p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline" id="del-confirm-modal-no-btn" (click)="confirmationModal(false)"
                mltag="txt_no">No
        </button>
        <button type="button" class="btn btn-primary" id="del-confirm-modal-yes-btn" (click)="confirmationModal(true)"
                mltag="txt_yes">Yes
        </button>
    </div>
</clr-modal>

<!-- Accept connection modal -->
<clr-modal [(clrModalOpen)]="isAcceptModalDisplayed">
    <h3 class="modal-title">Select the subportfolio address you want to bind to this connection</h3>
    <div class="modal-body">
        <ng-select
                id="accept-subportfolio-addr-link"
                [items]="addressList"
                [allowClear]=true
                placeholder="Select a sub-portfolio"
                [formControl]="formGroup.controls['sub-portfolio']">
        </ng-select>
        <span class="mandatory-field">*</span>
        <div *ngIf="formGroup.controls['sub-portfolio'].hasError('required') && formGroup.controls['sub-portfolio'].touched"
             class="text-danger">This field is required
        </div>
    </div>

    <div class="modal-footer">
        <button type="button"
                id="accept-connection-cancel-btn"
                class="btn btn-outline"
                (click)="handleAcceptConnection(false)">
            Cancel
        </button>
        <button type="button"
                id="accept-connection-submit-btn"
                class="btn btn-primary"
                (click)="handleAcceptConnection(true)">
            Submit
        </button>
    </div>
</clr-modal>
