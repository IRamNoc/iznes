<div class="header-breadcrumbs">
    <h1><i class="fa fa-users"></i> {{ 'Connections' | translate }}</h1>
</div>

<clr-tabs>
    <!-- Accepted connections tab -->
    <clr-tab>
        <button id="accepted-connection-tab" clrTabLink>
            <i class="fa fa-check"></i>
            <span>Accepted</span>
        </button>

        <ng-template [(clrIfActive)]="isAcceptedTabDisplayed">
            <clr-tab-content>
                <section class="form-block">
                    <clr-datagrid>
                        <clr-dg-column [clrDgField]="'connections'">{{ 'Connection' | translate }}</clr-dg-column>
                        <clr-dg-column [clrDgField]="'subportfolios'">{{ 'Address' | translate }}</clr-dg-column>
                        <clr-dg-column class="right">{{ 'Actions' | translate }}</clr-dg-column>

                        <clr-dg-row *clrDgItems="let acceptedConnection of acceptedConnectionList">
                            <clr-dg-cell>{{acceptedConnection.connection}}</clr-dg-cell>
                            <clr-dg-cell>{{acceptedConnection.subPortfolio}}</clr-dg-cell>
                            <clr-dg-cell class="right">
                                <button id="edit-button" class="btn btn-success btn-sm"
                                        (click)="handleEditButtonClick(acceptedConnection)">
                                    <i class="fa fa-edit"></i>{{ 'Edit' | translate }}
                                </button>
                                <button id="delete-button" class="btn btn-danger btn-sm"
                                        (click)="handleDeleteButtonClick(acceptedConnection)">
                                    <i class="fa fa-trash-o"></i>{{ 'Delete' | translate }}
                                </button>
                            </clr-dg-cell>
                        </clr-dg-row>

                        <clr-dg-footer>
                            <div rowsPerPage="10" (rowsUpdate)="pageSize = $event"></div>
                            {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
                            <clr-dg-pagination #pagination [clrDgPageSize]="pageSize"></clr-dg-pagination>
                        </clr-dg-footer>
                    </clr-datagrid>
                </section>
            </clr-tab-content>
        </ng-template>
    </clr-tab>

    <!-- Pending connections tab -->
    <clr-tab>
        <button id="pending-connection-tab" clrTabLink>
            <i class="fa fa-ellipsis-h"></i> {{ 'Pending' | translate }}
        </button>

        <clr-tab-content>
            <section class="form-block">
                <clr-datagrid>
                    <clr-dg-column [clrDgField]="'connections'">{[ 'Connection' | translate }}</clr-dg-column>
                    <clr-dg-column [clrDgField]="'info'">{{ 'Status' | translate }}</clr-dg-column>
                    <clr-dg-column class="right">{{ 'Actions' | translate }}</clr-dg-column>

                    <clr-dg-row *clrDgItems="let pendingConnection of pendingConnectionList">
                        <clr-dg-cell>{{pendingConnection.connection}}</clr-dg-cell>
                        <clr-dg-cell>{{pendingConnection.info}}</clr-dg-cell>

                        <clr-dg-cell *ngIf="pendingConnection.info === 'Outgoing'" class="right">
                            <button id="reject-connection-button" class="btn btn-danger btn-sm"
                                    (click)="handleRejectButtonClick(pendingConnection, 'This connection request has been cancelled')">
                                <i class="fa fa-times"></i> {{ 'Cancel' | translate }}
                            </button>
                        </clr-dg-cell>

                        <clr-dg-cell *ngIf="pendingConnection.info === 'Incoming'" class="right">
                            <button id="accept-connection-button" class="btn btn-success btn-sm"
                                    (click)="handleAcceptButtonClick(pendingConnection)">
                                <i class="fa fa-check"></i> {{ 'Accept' | translate }}
                            </button>

                            <button id="reject-connection-button" class="btn btn-danger btn-sm"
                                    (click)="handleRejectButtonClick(pendingConnection)">
                                <i class="fa fa-ban"></i> {{ 'Reject' | translate }}
                            </button>

                        </clr-dg-cell>
                    </clr-dg-row>

                    <clr-dg-footer>
                        {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
                        <clr-dg-pagination #pagination [clrDgPageSize]="10"></clr-dg-pagination>
                    </clr-dg-footer>
                </clr-datagrid>
            </section>
        </clr-tab-content>
    </clr-tab>

    <!-- Add connection tab -->
    <clr-tab>
        <button id="add-connection-tab" clrTabLink (click)="resetForm()">
            <i class="fa fa-plus"></i> {{ 'Add Connection' | translate }}
        </button>

        <clr-tab-content>
            <form [formGroup]="formGroup" novalidate (ngSubmit)="handleSubmitButtonClick()">
                <section class="form-block">
                    <div class="row">
                        <div class="form-group col-sm-6">

                            <div class="tooltip left tooltip-sm">
                                <i class="fa fa-info-circle"></i>
                                <span class="tooltip-content">{{ 'Select a wallet to connect to' | translate }}</span>        
                                <label class="control-label required-field" for="add-connection-select">{{ 'Connection' | translate }}</label>
                            </div>

                            <ng-select
                                    id="add-connection-select"
                                    placeholder="{{ 'Select wallet' | translate }}"
                                    [items]="walletList"
                                    [allowClear]=true
                                    [formControl]="formGroup.controls['connection']">
                            </ng-select>

                            <span *ngIf="formGroup.controls['connection'].hasError('required') && formGroup.controls['connection'].touched"
                                  class="field-error">{{ 'Field is required' | translate }}</span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group col-sm-6">

                            <div class="tooltip left tooltip-sm">
                                <i class="fa fa-info-circle"></i>
                                <span class="tooltip-content">{{ 'Select an address to use for this connection' | translate }}</span>
                                <label class="control-label required-field" for="add-subportfolio-select">{{ 'Address' | translate }}</label>
                            </div>

                            <ng-select 
                                id="add-subportfolio-select" 
                                [items]="addressList" 
                                [allowClear]=true 
                                placeholder="{{ 'Select address' | translate }}" 
                                [formControl]="formGroup.controls['sub-portfolio']">
                            </ng-select>

                            <span *ngIf="formGroup.controls['sub-portfolio'].hasError('required') && formGroup.controls['sub-portfolio'].touched"
                                  class="field-error">{{ 'Field is required' | translate }}</span>
                        </div>
                    </div>

                    <div class="row">
                        <button id="add-connection-button" class="btn btn-primary" [disabled]="formGroup.invalid">
                            <i class="fa fa-save"></i> {{ 'Save' | translate }}
                        </button>
                    </div>
                </section>
            </form>
        </clr-tab-content>
    </clr-tab>

    <!-- Edit connection tab -->
    <clr-tab *ngIf="!isEditTabClosed">
        <button id="edit-connection-tab" clrTabLink>
            <i class="fa fa-pencil"></i>
            {{ 'Edit Connection' | translate }}
        </button>

        <ng-template [(clrIfActive)]="isEditTabDisplayed">
            <clr-tab-content>
                <form [formGroup]="formGroup" novalidate (ngSubmit)="handleSubmitButtonClick()">
                    <section class="form-block">
                        <div class="row">
                            <div class="form-group col-sm-6">                                

                                <label class="control-label required-field" for="add-connection-select">{{ 'Connection' | translate }}</label>

                                <ng-select
                                        id="edit-connection-select"
                                        placeholder="{[ 'Select a connection' | translate }}"
                                        [items]="walletList"
                                        [allowClear]=true
                                        [formControl]="formGroup.controls['connection']"
                                        [disabled]="isEditTabDisplayed">
                                </ng-select>

                                <span *ngIf="formGroup.controls['connection'].hasError('required') && formGroup.controls['connection'].touched"
                                      class="field-error">{{ 'Field is required' | translate }}</span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col-sm-6">
                                <div class="tooltip left tooltip-sm">
                                    <i class="fa fa-info-circle"></i>
                                    <span class="tooltip-content">{{ 'Select an address to use for this connection' | translate }}</span>
                                    <label class="control-label required-field" for="add-subportfolio-select">{{ 'Address' | translate }}</label>
                                </div>

                                <ng-select
                                        id="edit-subportfolio-select"
                                        [items]="addressList"
                                        [allowClear]=true
                                        placeholder="{{ 'Select address' | translate }}"
                                        [formControl]="formGroup.controls['sub-portfolio']">
                                </ng-select>

                                <span *ngIf="formGroup.controls['sub-portfolio'].hasError('required') && formGroup.controls['sub-portfolio'].touched"
                                      class="field-error">{{ 'Field is required' | translate }}</span>
                            </div>
                        </div>

                        <div class="row">
                            <button id="edit-connection-button" class="btn btn-primary" [disabled]="formGroup.invalid">
                                <i class="fa fa-save"></i> {{ 'Save' | translate }}
                            </button>
                            <button class="btn btn-secondary" (click)="handleCloseButtonClick()">
                                {{ 'Close' | translate }}
                            </button>
                        </div>
                    </section>
                </form>
            </clr-tab-content>
        </ng-template>
    </clr-tab>
</clr-tabs>

<!-- Accept connection modal -->
<clr-modal [(clrModalOpen)]="isAcceptModalDisplayed">
    <h3 class="modal-title">Select a sub-portfolio to use for this connection</h3>
    <div class="modal-body">
        <label class="control-label required-field" for="accept-subportfolio-addr-link">Sub-portfolio</label>
        <ng-select
                id="accept-subportfolio-addr-link"
                [items]="addressList"
                [allowClear]=true
                placeholder="{{ 'Select a sub-portfolio' | translate }}"
                [formControl]="formGroup.controls['sub-portfolio']">
        </ng-select>

        <span *ngIf="formGroup.controls['sub-portfolio'].hasError('required') && formGroup.controls['sub-portfolio'].touched"
              class="field-required">{{ 'Field is required' | translate }}</span>
    </div>

    <div class="modal-footer">
        <button type="button"
                id="accept-connection-cancel-btn"
                class="btn btn-outline"
                (click)="onAcceptConnection(false)">
            Cancel
        </button>
        <button type="button"
                id="accept-connection-submit-btn"
                class="btn btn-primary"
                (click)="onAcceptConnection(true)">
            Submit
        </button>
    </div>
</clr-modal>
