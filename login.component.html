<div class="login-container">
    <div>
        <div class="logo-wrap">
            <img id="{{appConfig.logoID}}" src="{{appConfig.logoUrl}}"/>
        </div>

        <div *ngIf="changedPassword" class="changedPasswordSuccess mt-2">
            <b>Your password has been changed!</b>
        </div>

        <div *ngIf="!showSignup" class="login-inner-wrapper">
            <span class="login-subheading">Log in to {{appConfig.platform}}</span>
            <br>
            <p class="login-subpara">Please enter your email and password<br>to log in to the {{appConfig.platform}} platform</p>
            <br>
            <form [formGroup]="loginForm" (ngSubmit)="login(loginForm.value)"
                  [class.error]="!loginForm.valid && loginForm.touched">

                <div class="form-group">
                    <input id="username-field" type="text" name="username" placeholder="User name" class="form-control"
                           formControlName="username"
                           [class.error]="!loginForm.controls['username'].valid && loginForm.controls['username'].touched"
                           mltag="txt_username"
                           autofocus>
                </div>
                <div class="form-group">
                    <input id="password-field" name="password" type="password" class="form-control" placeholder="Password"
                           formControlName="password"
                            [class.error]="!loginForm.controls['password'].valid && loginForm.controls['password'].touched"
                           mltag="txt_password">
                </div>

                <div class="form-group">
                    <button id="login-submit" type="submit" class="btn btn-primary block full-width m-b" mltag="txt_login">Login
                    </button>
                </div>

                <div *ngIf="!loginForm.controls['username'].valid && loginForm.controls['username'].touched"
                     class="alert-items">

                    <div class="alert alert-danger">
                        <div class="alert-items">
                            <div class="alert-item static">
                                <span class="alert-text" mltag="txt_usernameisrequired">Username is required</span>
                            </div>
                        </div>
                    </div>

                </div>

                <div *ngIf="!loginForm.controls['password'].valid && loginForm.controls['password'].touched"
                     class="alert-items">

                    <div class="alert alert-danger">
                        <div class="alert-items">
                            <div class="alert-item static">
                                <span class="alert-text" mltag="txt_passwordisrequired">Password is required</span>
                            </div>
                        </div>
                    </div>

                </div>

            </form>

            <p class="mt-1">
                <span class="ml"><a id="forgotten-password-link" [ngStyle]="{'cursor':'pointer'}" (click)="showFPModal()">Forgot your password?</a></span>
            </p>

        </div>

        <div *ngIf="showSignup" class="login-inner-wrapper">
            <span class="login-subheading">Sign up to {{appConfig.platform}}</span>
            <br>
            <p class="login-subpara">Your {{appConfig.platform}} account will be created with this email address, provided by the Asset Management company.</p>
            <br>
            <p class="login-subpara text-grey">Please choose a password.</p>
            <br>
            <form [formGroup]="signupForm" (ngSubmit)="signup(signupForm.value)"
                  [class.error]="!signupForm.valid && signupForm.touched">

                <div class="form-group">
                    <input id="su-username-field" type="text" name="username" placeholder="User name" class="form-control" disabled
                           formControlName="username"
                           [class.error]="!signupForm.controls['username'].valid && signupForm.controls['username'].touched"
                           mltag="txt_username">
                </div>
                <div class="form-group">
                    <div>
                        <input id="su-password-field" name="password" [type]="(showPasswords1 === true) ? 'text' : 'password'" class="form-control" placeholder="Password"
                               formControlName="password"
                               [class.error]="!signupForm.controls['password'].valid && signupForm.controls['password'].touched"
                               mltag="txt_password">
                        <span style="margin-top: -45px !important; position: absolute; right: 15px; font-size: 18px; line-height: 2em; color: grey; cursor:pointer;" (click)="toggleShowPasswords(1)" mltag="txt_showhidepassword" title="Show/hide passwords"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>
                    </div>
                    <div *ngIf="signupForm.controls.password.hasError('required') && signupForm.controls.password.dirty" class="text-danger" mltag="txt_passwordrequired">Password is required</div>
                    <div *ngIf="!signupForm.controls.password.valid && !signupForm.controls.password.hasError('required') && signupForm.controls.password.touched" class="text-danger" mltag="txt_password6chars">Your password must be at least 6 characters</div>
                </div>
                <div class="form-group">
                    <div>
                        <input id="su-passwordConfirm-field" name="passwordConfirm" [type]="(showPasswords2 === true) ? 'text' : 'password'" class="form-control" placeholder="Retype password"
                               formControlName="passwordConfirm"
                               [class.error]="!signupForm.controls.passwordConfirm.valid && signupForm.controls.passwordConfirm.touched">
                        <span style="margin-top: -45px !important; position: absolute; right: 15px; font-size: 18px; line-height: 2em; color: grey; cursor:pointer;" (click)="toggleShowPasswords(2)" mltag="txt_showhidepassword" title="Show/hide passwords"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>
                    </div>
                    <div *ngIf="signupForm.controls.passwordConfirm.hasError('required')
                                && signupForm.controls.passwordConfirm.touched" class="text-danger" mltag="txt_confirmationrequired">Confirmation is required</div>
                    <div *ngIf="signupForm.controls.passwordConfirm.hasError('minlength')
                                && !signupForm.controls.passwordConfirm.hasError('required')
                                && signupForm.controls.passwordConfirm.dirty" class="text-danger" mltag="txt_password6chars">Your password must be at least 6 characters</div>
                    <div *ngIf="!signupForm.controls.passwordConfirm.hasError('minlength')
                                && !signupForm.controls.passwordConfirm.hasError('required')
                                && signupForm.controls.passwordConfirm.dirty
                                && signupForm.hasError('mismatch')
                                && signupForm.controls.password.valid" class="text-danger" mltag="txt_passwordsdonotmatch">Password does not match</div>
                </div>

                <div class="form-group">
                    <button id="signup-submit" type="submit" class="btn btn-primary block full-width m-b" [disabled]="!signupForm.valid">Create an account</button>
                </div>
            </form>

        </div>

        <p>
            <small>
                <span class="ml" mltag="txt_setlopencsdisaprivateenvironmentsubjecttoauthorisedaccessonly">SETL OpenCSD is a private environment subject to authorised access only.</span>
            </small>
        </p>
    </div>
</div>

<!--CUSTOM TEXT MODALS-->
<clr-modal [(clrModalOpen)]="showModal" [clrModalClosable]="false">

    <h3 class="modal-title" *ngIf="(!emailSent || isTokenExpired) && !changePassword && !isSignUp">Forgotten password?</h3>
    <h3 class="modal-title" *ngIf="emailSent && !changePassword && !isSignUp">Email sent</h3>
    <h3 class="modal-title" *ngIf="changePassword && !isSignUp">Change your password</h3>
    <h3 class="modal-title" *ngIf="isSignUp">Success</h3>
    <div class="modal-body text-center" *ngIf="!emailSent && !changePassword && !isSignUp">
        <div *ngIf="isTokenExpired; else notExpired" class="text-center">
            <span class="text-danger">This link as expired!</span>
            <p><i class="fa fa-exclamation fa-5x text-danger" aria-hidden="true"></i></p>
            <p>Please retype your email address to change your password.</p>
        </div>
        <ng-template #notExpired>
            <p>Please enter your email address.</p>
            <i class="fa fa-envelope-o fa-5x text-muted" aria-hidden="true"></i>
        </ng-template>
        <form [formGroup]="forgottenPasswordForm" novalidate (ngSubmit)="sendEmail(forgottenPasswordForm.value)">
            <section class="form-block">
                <div class="form-group text-center">
                    <input id="fp-email-field" type="text" class="form-control" formControlName="email" placeholder="Email address">
                    <div [ngStyle]="{'height':'24px'}" *ngIf="forgottenPasswordForm.controls.email.valid || forgottenPasswordForm.controls.email.pristine"></div>
                    <div *ngIf="forgottenPasswordForm.controls.email.hasError('required') && forgottenPasswordForm.controls.email.dirty" class="text-danger" mltag="txt_thisfieldisrequired">This field is required</div>
                    <div *ngIf="!forgottenPasswordForm.controls.email.valid && !forgottenPasswordForm.controls.email.hasError('required')" class="text-danger">Email not valid!</div>
                </div>
                <div class="text-center">
                    <small>If you click Send, an email will be sent to this address.</small>
                </div>
                <div class="text-center mt-1">
                    <button id="fp-cancel-sendemail-button" class="btn btn-info" type="button" (click)="closeFPModal()">
                        <span mltag="txt_cancel">Cancel</span>
                    </button>
                    <button id="fp-submit-sendemail-button" type="submit" class="btn btn-success" [disabled]="!forgottenPasswordForm.valid">
                        <span mltag="txt_sendtoform">Send</span>
                    </button>
                </div>
            </section>
        </form>
    </div>
    <div class="modal-body text-center" *ngIf="emailSent && !changePassword && !isSignUp">
        <p>An email has been sent to the email address:<br><b [ngStyle]="{'color':'#62a420'}">{{emailUser}}</b></p>
        <br>
        <i class="fa fa-paper-plane-o fa-5x" aria-hidden="true"></i>
        <br><br>
        This pop-up will automatically close in {{countdown}} seconds.
        <br><br>
        <button id="fp-newpassword-close-button" class="btn btn-info" type="button" (click)="closeFPModal()">
            <span mltag="txt_close">Close</span>
        </button>
        <br><br>
    </div>
    <div class="modal-body text-center" *ngIf="isSignUp">
        <p>Your account was created</p>
        <br>
        <i class="fa fa-check fa-5x text-success" aria-hidden="true"></i>
        <br><br>
        <small>A confirmation email was sent to you.</small>
        <br><br>
        <button id="su-continu-button" class="btn btn-info" type="button" (click)="logAfterSignup()">
            <span>Continue to {{appConfig.platform}}</span>
        </button>
        <br><br>
    </div>
    <div class="modal-body text-center" *ngIf="changePassword && !isSignUp">
        <p>Please type a password</p>
        <br>
        <i class="fa fa-key fa-5x" [ngStyle]="{'color':'#62a420'}" aria-hidden="true"></i>
        <br><br>
        <form [formGroup]="changePasswordForm" novalidate (ngSubmit)="saveNewPassword(changePasswordForm.value)">
            <section class="form-block">
                <div class="form-group">
                    <div>
                        <input id="fp-password-field" [type]="(showPasswords1 === true) ? 'text' : 'password'" class="form-control" formControlName="password" size="45" placeholder="New password">
                        <span style="margin-top: -45px !important; position: absolute; right: 15px; font-size: 18px; line-height: 2em; color: grey; cursor:pointer;" (click)="toggleShowPasswords(1)" mltag="txt_showhidepassword" title="Show/hide passwords"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>
                    </div>
                    <div [ngStyle]="{'height':'24px'}" *ngIf="changePasswordForm.controls.password.valid || changePasswordForm.controls.password.pristine"></div>
                    <div *ngIf="changePasswordForm.controls.password.hasError('required') && changePasswordForm.controls.password.dirty" class="text-danger" mltag="txt_passwordrequired">Password is required</div>
                    <div *ngIf="!changePasswordForm.controls.password.valid && !changePasswordForm.controls.password.hasError('required') && changePasswordForm.controls.password.touched" class="text-danger" mltag="txt_password6chars">Your password must be at least 6 characters</div>
                </div>
                <div class="form-group text-center">
                    <div>
                        <input id="fp-passwordconfirm-field" [type]="(showPasswords2 === true) ? 'text' : 'password'" class="form-control" formControlName="passwordConfirm" placeholder="Password confirmation">
                        <span style="margin-top: -45px !important; position: absolute; right: 15px; font-size: 18px; line-height: 2em; color: grey; cursor:pointer;" (click)="toggleShowPasswords(2)" mltag="txt_showhidepassword" title="Show/hide passwords"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>
                    </div>
                    <div [ngStyle]="{'height':'24px'}" *ngIf="changePasswordForm.controls.passwordConfirm.valid || changePasswordForm.controls.passwordConfirm.pristine"></div>
                    <div *ngIf="changePasswordForm.controls.passwordConfirm.hasError('required') && changePasswordForm.controls.passwordConfirm.dirty" class="text-danger" mltag="txt_confirmationrequired">Confirmation is required</div>
                    <div *ngIf="changePasswordForm.controls.passwordConfirm.hasError('minlength') && !changePasswordForm.controls.passwordConfirm.hasError('required') && changePasswordForm.controls.passwordConfirm.dirty" class="text-danger" mltag="txt_password6chars">Your password must be at least 6 characters</div>
                    <div *ngIf="!changePasswordForm.controls.passwordConfirm.hasError('minlength') && changePasswordForm.hasError('mismatch') && changePasswordForm.controls.password.valid && !changePasswordForm.controls.passwordConfirm.hasError('required') && changePasswordForm.controls.passwordConfirm.dirty" class="text-danger" mltag="txt_passwordsdonotmatch">Password does not match</div>
                </div>
                <div class="text-center mt-1">
                    <button id="fp-newpassword-cancel-button" class="btn btn-info" type="button" (click)="closeFPModal()">
                        <span mltag="txt_cancel">Cancel</span>
                    </button>
                    <button id="fp-newpassword-submit-button" type="submit" class="btn btn-success" [disabled]="!changePasswordForm.valid">
                        <span mltag="txt_sendtoform">Send</span>
                    </button>
                </div>
            </section>
        </form>
    </div>
</clr-modal>