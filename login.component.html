<toaster-container></toaster-container>

<div class="login-container">
    <div>
        <div class="logo-wrap">
            <img id="{{appConfig.logoID}}" src="{{appConfig.logoUrl}}">
        </div>

        <div class="login-inner-wrapper">
            <span class="login-subheading">
                {{'Log in to @appConfig.platform@' | translate: {'appConfig.platform': appConfig.platform} }}
            </span>
            <br>
            <p class="login-subpara">
                {{'Please enter your username and password to log in to the @appConfig.platform@ platform' | translate: {'appConfig.platform': appConfig.platform} }}
            </p>
            <br>
            <form [formGroup]="loginForm" (ngSubmit)="login(loginForm.value)" [class.error]="!loginForm.valid && loginForm.touched">
                <div class="form-group">
                    <input
                            id="username-field"
                            type="text"
                            name="username"
                            [placeholder]="_translate.translate('Username')"
                            class="form-control"
                            formControlName="username"
                            [class.error]="!loginForm.controls['username'].valid && loginForm.controls['username'].touched"
                            #usernameInput
                    >
                    <div *ngIf="!loginForm.controls['username'].valid && loginForm.controls['username'].touched" class="field-error">
                        {{'Username is required' | translate}}
                    </div>
                </div>

                <div class="form-group">
                    <input
                            id="password-field"
                            name="password"
                            type="password"
                            class="form-control"
                            [placeholder]="_translate.translate('Password')"
                            formControlName="password"
                            [class.error]="!loginForm.controls['password'].valid && loginForm.controls['password'].touched"
                            #passwordInput
                    >
                    <div *ngIf="!loginForm.controls['password'].valid && loginForm.controls['password'].touched" class="field-error">
                        {{'Password is required' | translate}}
                    </div>
                </div>

                <div class="form-group">
                    <button id="login-submit" type="submit" class="btn btn-primary block full-width m-b">
                        {{'Login' | translate}}
                    </button>
                </div>
            </form>

            <p class="mt-1">
                <span class="ml">
                    <a id="forgotten-password-link" [ngStyle]="{'cursor':'pointer'}" (click)="showFPModal()">
                        {{'Forgot your password?' | translate}}
                    </a>
                </span>
            </p>
        </div>
        <p>
            <small>
                <span class="ml">
                    {{'SETL OpenCSD is a private environment subject to authorised access only.' | translate}}</span>
            </small>
        </p>
    </div>
</div>

<!--CUSTOM TEXT MODALS-->
<clr-modal [(clrModalOpen)]="showModal" [clrModalClosable]="false">
    <h3 class="modal-title" *ngIf="(!emailSent || isTokenExpired) && !changePassword">
        {{'Forgotten password?' | translate}}
    </h3>
    <h3 class="modal-title" *ngIf="emailSent && !changePassword">
        {{'Email sent' | translate}}
    </h3>
    <h3 class="modal-title" *ngIf="changePassword">
        {{'Change your password' | translate}}
    </h3>
    <div class="modal-body text-center" *ngIf="!emailSent && !changePassword">
        <div *ngIf="isTokenExpired; else notExpired" class="text-center">
            <span class="text-danger">
                {{'This link has expired!' | translate}}
            </span>
            <p><i class="fa fa-exclamation fa-5x text-danger" aria-hidden="true"></i></p>
            <p>{{'Please retype your email address to change your password.' | translate}}</p>
        </div>
        <ng-template #notExpired>
            <p>{{'Please enter your email address.' | translate}}</p>
            <i class="fa fa-envelope-o fa-5x text-muted" aria-hidden="true"></i>
        </ng-template>
        <form [formGroup]="forgottenPasswordForm" novalidate (ngSubmit)="sendEmail(forgottenPasswordForm.value)">
            <section class="form-block">
                <div class="form-group text-center">
                    <input id="fp-email-field" type="text" class="form-control" formControlName="email" [placeholder]="_translate.translate('Email address')">
                    <div [ngStyle]="{'height':'24px'}">
                        <div *ngIf="forgottenPasswordForm.controls.email.hasError('required') && forgottenPasswordForm.controls.email.dirty" class="text-danger">
                            {{'This field is required' | translate}}
                        </div>
                        <div *ngIf="!forgottenPasswordForm.controls.email.valid && !forgottenPasswordForm.controls.email.hasError('required')" class="text-danger">
                            {{'Email not valid!' | translate}}
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <small>{{'If you click Send, an email will be sent to this address.' | translate}}</small>
                </div>
                <div class="text-center mt-1">
                    <button id="fp-cancel-sendemail-button" class="btn btn-info" type="button" (click)="closeFPModal()">
                        {{'Cancel' | translate}}
                    </button>
                    <button id="fp-submit-sendemail-button" type="submit" class="btn btn-success" [disabled]="!forgottenPasswordForm.valid">
                        {{'Send' | translate}}
                    </button>
                </div>
            </section>
        </form>
    </div>

    <div class="modal-body text-center" *ngIf="emailSent && !changePassword">
        <p>{{'An email has been sent to the email address' | translate}}:
            <br>
            <b [ngStyle]="{'color':'#62a420'}">{{emailUser}}</b>
        </p>
        <br>
        <i class="fa fa-paper-plane-o fa-5x" aria-hidden="true"></i>
        <br><br>
        {{'This pop-up will automatically close in @countdown@ seconds.' | translate: {'countdown': countdown} }}
        <br><br>
        <button id="fp-newpassword-close-button" class="btn btn-info" type="button" (click)="closeFPModal()">
            {{'Close' | translate}}
        </button>
        <br><br>
    </div>

    <div class="modal-body text-center" *ngIf="changePassword">
        <p>{{'Please type a password' | translate}}</p>
        <br>
        <i class="fa fa-key fa-5x" [ngStyle]="{'color':'#62a420'}" aria-hidden="true"></i>
        <br><br>
        <form [formGroup]="changePasswordForm" novalidate (ngSubmit)="saveNewPassword(changePasswordForm.value)">
            <section class="form-block">
                <div class="form-group">
                    <div>
                        <input id="fp-password-field"
                               [type]="(showPasswords1 === true) ? 'text' : 'password'"
                               class="form-control"
                               formControlName="password"
                               size="45"
                               [placeholder]="_translate.translate('New password')"
                        >
                        <span style="margin-top: -45px !important; position: absolute; right: 15px; font-size: 18px; line-height: 2em; color: grey; cursor:pointer;" (click)="toggleShowPasswords(1)" [title]="_translate.translate('Show/hide passwords')">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                    </div>
                    <div [ngStyle]="{'height':'24px'}">
                        <div *ngIf="changePasswordForm.controls.password.hasError('required') && changePasswordForm.controls.password.dirty" class="text-danger">
                            {{'Password is required' | translate}}
                        </div>
                        <div *ngIf="!changePasswordForm.controls.password.valid && !changePasswordForm.controls.password.hasError('required') && changePasswordForm.controls.password.touched" class="text-danger">
                            {{'Your password must be at least 6 characters' | translate}}
                        </div>
                    </div>
                </div>
                <div class="form-group text-center">
                    <div>
                        <input id="fp-passwordconfirm-field"
                               [type]="(showPasswords2 === true) ? 'text' : 'password'"
                               class="form-control"
                               formControlName="passwordConfirm"
                               [placeholder]="_translate.translate('Password confirmation')">
                        <span style="margin-top: -45px !important; position: absolute; right: 15px; font-size: 18px; line-height: 2em; color: grey; cursor:pointer;" (click)="toggleShowPasswords(2)" [title]="_translate.translate('Show/hide passwords')">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                    </div>
                    <div [ngStyle]="{'height':'24px'}">
                        <div *ngIf="changePasswordForm.controls.passwordConfirm.hasError('required') && changePasswordForm.controls.passwordConfirm.dirty" class="text-danger">
                            {{'Confirmation is required' | translate}}
                        </div>
                        <div *ngIf="changePasswordForm.controls.passwordConfirm.hasError('minlength') && !changePasswordForm.controls.passwordConfirm.hasError('required') && changePasswordForm.controls.passwordConfirm.dirty" class="text-danger">
                            {{'Your password must be at least 6 characters' | translate}}
                        </div>
                        <div *ngIf="!changePasswordForm.controls.passwordConfirm.hasError('minlength') && changePasswordForm.hasError('mismatch') && changePasswordForm.controls.password.valid && !changePasswordForm.controls.passwordConfirm.hasError('required') && changePasswordForm.controls.passwordConfirm.dirty" class="text-danger">
                            {{'Password does not match' | translate}}
                        </div>
                    </div>
                </div>
                <div class="text-center mt-1">
                    <button id="fp-newpassword-cancel-button" class="btn btn-info" type="button" (click)="closeFPModal()">
                        {{'Cancel' | translate}}
                    </button>
                    <button id="fp-newpassword-submit-button" type="submit" class="btn btn-success" [disabled]="!changePasswordForm.valid">
                        {{'Validate' | translate}}
                    </button>
                </div>
            </section>
        </form>
    </div>
</clr-modal>