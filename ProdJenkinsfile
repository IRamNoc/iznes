node
  {
    stage('Check Out Application Code'){

      checkout([$class: 'GitSCM', branches: [[name: '*/master']],
                doGenerateSubmoduleConfigurations: false, extensions: [],
                submoduleCfg: [], userRemoteConfigs:
                  [[credentialsId: '6afd5a8d-023a-49f6-ba58-4f6b35cf3023',
                    url: 'git@si-nexus01.dev.setl.io:opencsd-rewrite/opencsd-frontend-clarity.git']]])
    }

    stage('Build & Unit Test'){

      sh '''rm yarn.lock &&
              yarn install &&
              yarn test-single &&
              cd src &&
              sass styles.scss:styles.css &&
              yarn build-prod &&
              cd ../ &&
              yarn build-prod '''
      junit allowEmptyResults: true, keepLongStdio: true,
                   testResults: '/TESTS-Headless**'
    }


    stage('Sonar Scan'){
      withSonarQubeEnv {

        sh 'sudo gulp sonar --project New_OpenCSD_FrontEnd '
      }
    }
  }
