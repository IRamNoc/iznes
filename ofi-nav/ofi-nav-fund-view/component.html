<div class="header-breadcrumbs" *ngIf="navFund">
    <h1>
        <i class="fa fa-ellipsis-h"></i>{{'Net asset value: @navFund.fundShareName@' | translate: {'navFund.fundShareName': navFund.fundShareName} }}

    </h1>{{'View and manage NAV\'s for a share.' | translate}}


</div>

<clr-tabs>
    <clr-tab>
        <button id="netAssetValueTab" clrTabLink>
            <i class="fa fa-th-list"></i>{{'View' | translate}}

        </button>

        <clr-tab-content *clrIfActive="true">
            <!-- Button container -->
            <div class="row">
                <div class="form-group button-container">
                    <button class="btn btn-primary" id="uploadDetailNavFileButton" (click)="isNavUploadModalDisplayed = true">
                        {{'Upload NAVs' | translate}}
                    </button>

                    <button class="btn btn-primary" (click)="exportCSV()">{{'Export List as CSV' | translate}}</button>
                </div>
            </div>

            <div class="hr-line-dashed"></div>

            <form *ngIf="navFund">
                <div class="row">
                    <div class="form-group col-sm-3">
                        <label class="control-label" for="shareName">{{'Share name' | translate}}</label>
                        <input type="text" id="shareName" name="shareName" value="{{navFund.fundShareName}}" readonly>
                    </div>

                    <div class="form-group col-sm-3">
                        <label class="control-label" for="isin">{{'ISIN' | translate}}</label>
                        <input type="text" id="isin" name="isin" value="{{navFund.isin}}" readonly>
                    </div>

                    <div class="form-group col-sm-5">
                        <label class="control-label" for="amCompany">{{'Asset Management Company' | translate}}</label>
                        <input type="text" id="amCompany" name="amCompany" value="{{navFund.asm}}" readonly>
                    </div>
                </div>

                <div class="hr-line-dashed"></div>
                <span class="text-badge">{{'Current NAV Information' | translate}}</span>

                <div class="row">
                    <div class="form-group col-sm-2">
                        <label class="control-label" for="currentDate">{{'Date' | translate}}</label>
                        <input type="text" id="currentDate" name="currentDate" value="{{currentDate}}" readonly>
                    </div>

                    <div class="form-group col-sm-2">
                        <label class="control-label" for="navCurrency">{{'NAV Currency' | translate}}</label>
                        <input type="text" id="navCurrency" name="navCurrency" value="{{getCurrencyString(navFund.currency)}} ({{getCurrencySymbol(navFund.currency)}})" readonly>
                    </div>

                    <div class="form-group col-sm-2">
                        <label class="control-label" for="nav">{{'NAV' | translate}}</label>
                        <input type="text" id="nav" name="nav" value="{{ navFund.nav !== null ? navToFrontEndString(navFund.nav) : 'Pending'}}" readonly>
                    </div>

                    <div class="form-group col-sm-2">
                        <label class="control-label" for="numberofshare">{{'Number of Shares' | translate}}</label>
                        <input type="text" id="numberofshare" name="numberofshare" value="" readonly>
                    </div>

                    <div class="form-group col-sm-2">
                        <label class="control-label" for="aum">{{'AUM' | translate}}</label>
                        <input type="text" id="aum" name="aum" value="" readonly>
                    </div>
                </div>
            </form>

            <div class="hr-line-dashed"></div>
            <span class="text-badge">{{'NAV History' | translate}}</span>

            <form [formGroup]="navHistoryForm">
                <div class="form-horizontal">
                    <div class="row">
                        <div class="form-group col-sm-2">
                            <label class="control-label" for="navDateFrom">{{'Date From' | translate}}</label>
                            <div class="input-group date-pick-wrapper">
                                <span class="fa fa-calendar"></span>
                                <input id="navDateFrom" name="navDateFrom" [placeholder]="_translate.translate('Select date')" formControlName="navDateFrom" [dpDayPicker]="dateFromConfig" mode="day" theme="dp-material">
                            </div>
                        </div>

                        <div class="form-group col-sm-2">
                            <label class="control-label" for="navDateTo">{{'Date To' | translate}}</label>
                            <div class="input-group date-pick-wrapper">
                                <span class="fa fa-calendar"></span>
                                <input id="navDateTo" name="navDateTo" [placeholder]="_translate.translate('Select date')" formControlName="navDateTo" [dpDayPicker]="dateToConfig" mode="day" theme="dp-material">
                            </div>
                        </div>

                        <div class="form-group col-sm-1 text-center">
                            <label class="control-label">{{'&nbsp;' | translate}}</label>
                            <div><strong>{{'- or -' | translate}}</strong></div>
                        </div>

                        <div class="form-group col-sm-3">
                            <label class="control-label" for="searchDatePeriod">{{'Date Period' | translate}}</label>
                            <ng-select id="searchDatePeriod" class="fluid-width" [items]="datePeriodItems" formControlName="datePeriod" [allowClear]="true" [placeholder]="_translate.translate('Select date period')">
                            </ng-select>
                        </div>

                        <div class="form-group col-sm-4 add-new-nav">
                            <label class="control-label">{{'&nbsp;' | translate}}</label>
                            <button class="btn btn-primary" (click)="addNav()">{{'Add New NAV' | translate}}</button>
                            <button class="btn" (click)="goToAuditTrail()">{{'NAV Audit Trail' | translate}}</button>
                        </div>
                    </div>
                </div>
            </form>

            <clr-datagrid #dataGrid>
                <clr-dg-column class="col-date">{{'NAV Date' | translate}}

                </clr-dg-column>
                <clr-dg-column class="col-date">{{'Publication Date' | translate}}

                </clr-dg-column>
                <!--<clr-dg-column>-->
                <!--<span>Use</span>-->
                <!--</clr-dg-column>-->
                <clr-dg-column class="col-currency">{{'NAV CCY' | translate}}

                </clr-dg-column>
                <clr-dg-column>{{'NAV' | translate}}

                </clr-dg-column>
                <clr-dg-column>{{'Number of Shares' | translate}}

                </clr-dg-column>
                <clr-dg-column>{{'Share AUM' | translate}}

                </clr-dg-column>
                <!--<clr-dg-column>-->
                <!--<span>Parity</span>-->
                <!--</clr-dg-column>-->
                <!--<clr-dg-column>-->
                <!--<span>Fund AUM</span>-->
                <!--</clr-dg-column>-->
                <clr-dg-column>{{'Coupons' | translate}}

                </clr-dg-column>
                <clr-dg-column class="col-status">{{'Status' | translate}}

                </clr-dg-column>
                <clr-dg-column class="actions">{{'Actions' | translate}}

                </clr-dg-column>

                <clr-dg-row *clrDgItems="let item of navFundHistory; let i = index" id="{{'product-nav-history-row' + i}}">
                    <clr-dg-cell id="{{'nav-history-row'+i+'-col-date'}}" class="col-date">{{item.navDate}}</clr-dg-cell>
                    <clr-dg-cell id="{{'nav-history-row'+i+'-col-pub-date'}}" class="col-date">{{item.navPubDate}}</clr-dg-cell>
                    <clr-dg-cell id="{{'nav-history-row'+i+'-col-currency'}}" class="col-currency">{{'@getCurrencyString(item.currency)@ (@getCurrencySymbol(item.currency)@)' | translate: {'getCurrencyString(item.currency)': getCurrencyString(item.currency),'getCurrencySymbol(item.currency)': getCurrencySymbol(item.currency)} }}</clr-dg-cell>
                    <clr-dg-cell>
                        <span [hidden]="isNavNull(item.nav)">{{navToFrontEndString(item.nav)}}</span>
                        <span [hidden]="!isNavNull(item.nav)" class="label label-warning">{{'Pending' | translate}}</span>
                    </clr-dg-cell>
                    <clr-dg-cell>
                    </clr-dg-cell>
                    <clr-dg-cell>
                    </clr-dg-cell>
                    <clr-dg-cell>
                    </clr-dg-cell>
                    <clr-dg-cell class="col-status">
                        <span [ngSwitch]="item.status">
                            <span *ngSwitchCase="-1">
                                <span class="label label-success">{{'Validated' | translate}}</span>
                            </span>
                            <span *ngSwitchCase="1">
                                <span class="label label-warning">{{'Estimated' | translate}}</span>
                            </span>

                            <span *ngSwitchCase="2">
                                <span class="label label-warning">{{'Technical' | translate}}</span>
                            </span>
                        </span>
                    </clr-dg-cell>
                    <clr-dg-cell class="actions">
                        <div class="btn-group btn-sm">
                            <button id="{{'nav-history-row'+i+'-btn-edit'}}" (click)="editNav(item)" class="btn btn-success btn-sm">
                                <i class="fa fa-edit"></i> {{'Edit NAV' | translate}}
                            </button>
                            <button id="{{'nav-history-row'+i+'-cancel-edit'}}" [attr.disabled]="item.status == -1 ? '' : null " (click)="cancelNav(item)" class="btn btn-danger btn-sm">
                                <i class="fa fa-remove"></i> {{'Delete NAV' | translate}}
                            </button>
                        </div>
                    </clr-dg-cell>
                </clr-dg-row>

                <clr-dg-footer>{{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}

                    <clr-dg-pagination #pagination [clrDgPageSize]="10"></clr-dg-pagination>
                </clr-dg-footer>
            </clr-datagrid>

            <form>
                <div class="row">
                    <div class="form-block form-group col-sm-6">
                        <a href="/#/product-module/net-asset-value" class="btn btn-secondary">{{'Close' | translate}}</a>
                    </div>
                </div>
            </form>
        </clr-tab-content>
    </clr-tab>
</clr-tabs>

<app-nav-add></app-nav-add>

<!-- NAV upload modal -->
<clr-modal [(clrModalOpen)]="isNavUploadModalDisplayed" [clrModalSize]="'sm'">
    <h3 class="modal-title" *ngIf="navFund">
        {{'Upload NAVs for @navFund.fundShareName@' | translate: {'navFund.fundShareName': navFund.fundShareName} }}
    </h3>

    <div class="modal-body">
        <p class="text-center text-warning">{{'This may take a few moments' | translate}}</p>

        <form>
            <section class="form-block">
                <div class="form-group col-sm-12">
                    <label class="control-label" for="detailNavCsvFile">{{'File to upload: ' | translate}}</label>
                    <input #detailNavCsvFile
                           id="detailNavCsvFile"
                           name="detailNavCsvFile"
                           type="file"
                           accept="text/csv"
                           (change)="this.navCsvFile = $event.target.files[0]"
                    />
                </div>
            </section>
        </form>
    </div>

    <div class="modal-footer">
        <button type="button"
                class="btn btn-outline"
                (click)="resetNavUploadModal()">
            {{'Cancel' | translate}}
        </button>

        <button type="button"
                class="btn btn-success"
                (click)="handleUploadNavSubmitClick()"
                [disabled]="!navCsvFile">
            {{'Upload' | translate}}
        </button>
    </div>
</clr-modal>