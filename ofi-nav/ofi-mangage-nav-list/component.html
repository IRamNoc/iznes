<div class="header-breadcrumbs">
    <h1><i class="fa fa-industrial"></i> NAV</h1>
</div>

<div class="wrapper wrapper-content">

    <clr-tabs>
        <clr-tab>
            <button clrTabLink><i class="fa {{tabDetail.title.icon}}"></i> {{tabDetail.title.text}}</button>
            <clr-tab-content *clrIfActive="true">
                <!-- NAV list tab. -->
                <ng-container>
                    <ng-container
                        *ngTemplateOutlet="navListTab"
                    ></ng-container>
                </ng-container>
            </clr-tab-content>
        </clr-tab>
    </clr-tabs>

    <!-- Nav Data Table. -->
    <ng-template #navListTab>
        <div class="panel-body">
            <form [formGroup]="searchForm" (ngSubmit)="handleSearchSubmit()">
                <div class="form-horizontal">
                    <div class="row">
                        <div class="form-group col-sm-4">
                            <label class="control-label">
                                <span class="ml_translated">Search by</span>
                            </label>
                            <div>
                                <ng-select
                                    class="fluid-width"
                                    [items]="allowSearchTypes"
                                    formControlName="searchBy"
                                    (selected)="selectSearchBy($event)"
                                ></ng-select>
                            </div>
                        </div>

                        <div class="form-group col-sm-4">
                            <label class="control-label">
                                <span class="ml_translated">Fund name</span>
                            </label>
                            <div>
                                <ng-select
                                    class="fluid-width"
                                    [items]="assetList"
                                    formControlName="fundName"
                                    [disabled]="searchBy === 'byDate'"
                                    (selected)="fundChange($event)"
                                ></ng-select>
                            </div>
                        </div>

                        <div class="form-group col-sm-4">
                            <label class="control-label">
                                <span class="ml_translated">Date</span>
                            </label>
                            <div class="input-group date-pick-wrapper">
                                <span class="fa fa-calendar" aria-hidden="true"></span>

                                <input
                                    formControlName="navDate"
                                    [(ngModel)]="navDate.value"
                                    [dpDayPicker]="configDate" placeholder="Choose a date"
                                    mode="day" theme="dp-material" [ngStyle]="{'width':'100%'}"
                                    [disabled]="searchBy === 'byFund'"
                                    (ngModelChange)="dateChange($event)"
                                />
                            </div>
                        </div>
                    </div>
                </div>
            </form>

            <clr-datagrid #myDataGrid>
                <clr-dg-column>Actions</clr-dg-column>
                <clr-dg-column>Fund name</clr-dg-column>
                <clr-dg-column>Fund ISIN</clr-dg-column>
                <clr-dg-column>Date</clr-dg-column>
                <clr-dg-column>Nav</clr-dg-column>
                <clr-dg-column>Status</clr-dg-column>

                <clr-dg-row *clrDgItems="let nav of navList;">
                    <clr-dg-cell>
                        <button class="btn" (click)="showEdit(nav.fundName, nav.nav, nav.date)" [disabled]="nav.status === -1">
                            <i class="fa fa-pencil-square-o"></i> Edit
                        </button>
                    </clr-dg-cell>

                    <clr-dg-cell>
                        {{nav.fundName}}
                    </clr-dg-cell>

                    <clr-dg-cell>
                        {{nav.fundIsin}}
                    </clr-dg-cell>

                    <clr-dg-cell>
                        {{nav.date}}
                    </clr-dg-cell>

                    <clr-dg-cell>
                        <span>
                            <span [ngSwitch]="nav.status">
                                <span *ngSwitchCase="-1">
                                    <span class="text-success">€ {{nav.nav | moneyValue}}</span>
                                </span>
                                <span *ngSwitchCase="1">
                                    <span class="text-warning">€ {{nav.nav | moneyValue}}</span>
                                </span>

                                <span *ngSwitchCase="2">
                                    <span class="text-warning">Pending</span>
                                </span>
                            </span>

                        </span>
                    </clr-dg-cell>

                    <clr-dg-cell>
                            <span [ngSwitch]="nav.status">
                                <span *ngSwitchCase="-1">
                                    <span class="label label-success">Final</span>
                                </span>
                                <span *ngSwitchCase="1">
                                    <span class="label label-warning">Estimated</span>
                                </span>

                                <span *ngSwitchCase="2">
                                    <span class="label label-warning">Pending</span>
                                </span>
                            </span>
                    </clr-dg-cell>
                </clr-dg-row>

                <clr-dg-footer>
                    {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
                    of {{pagination.totalItems}} accounts
                    <clr-dg-pagination #pagination [clrDgPageSize]="10"></clr-dg-pagination>
                </clr-dg-footer>
            </clr-datagrid>
        </div>
    </ng-template>


</div>

<clr-modal [(clrModalOpen)]="editing">
    <div class="modal-title">
        <i class="fa fa-industry modal-icon" style="color:#1AB399"></i>
        <h4 class="modal-title-text"><span class="ml_translated" mltag="txt_enternav">Enter NAV</span></h4>
    </div>
    <div class="modal-body">
        <form [formGroup]="navForm">
            <div class="form-horizontal">
                <div class="row">
                    <div class="form-group col-sm-12">
                        <label class="control-label"><span class="ml_translated" mltag="txt_fundname">Fund name</span></label>
                        <div>{{navFormFundName}}</div>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col-sm-12">
                        <label class="control-label"><span class="ml_translated" mltag="txt_date">Date</span></label>
                        <div>{{navFormDate}}</div>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col-sm-12">
                        <label class="control-label"><span class="ml_translated" mltag="txt_price">NAV</span> (€)</label>
                        <div>
                            <input formControlName="nav" type="text" class="form-control" value="" appNumberFormatter="2">
                        </div>
                    </div>
                </div>
            </div>

        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-warning price-update" data-action="estimate">
            <span class="ml_translated" mltag="txt_estimate" (click)="handleUpdateNav(1)">Estimate</span>
        </button>
        <button type="button" class="btn btn-primary price-update" data-action="final" (click)="handleUpdateNav(-1)">
            <span class="ml_translated" mltag="txt_final">Final</span></button>
        <button type="button" class="btn btn-outline" (click)="editing = false">Cancel</button>
    </div>
</clr-modal>
