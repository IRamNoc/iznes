<div class="header-breadcrumbs">
    <h1 id="manage-orders"><i class="fa fa-calendar"></i>
        <span>Centralisation History</span>
        <span *ngIf="baseCentralizationHistory.length > 0">{{baseCentralizationHistory.fundShareName}} - {{baseCentralizationHistory.isin}}</span>
    </h1>
</div>

<div class="wrapper wrapper-content">

    <clr-tabs *ngIf="tabsControl.length">
        <clr-tab *ngFor="let tabdata of tabsControl; let id = index">
            <button clrTabLink id="-{{id}}" [routerLink]="['/am-reports-section/centralization-history', (id === 0) ? shareID :  id]">
                <i class="fa {{tabdata.title.icon}}"></i> {{tabdata.title.text}}
            </button>
            <clr-tab-content *clrIfActive="tabdata.active">

                <form [formGroup]="searchForm" id="search-orders-form">
                    <div class="form-horizontal">
                        <div class="row bordered">
                            <div class="form-group col-sm-6">
                                <label style="margin: 10px 0;">
                                    <h3>Please find below the Centralisation history for {{baseCentralizationHistory.fundShareName}}</h3>
                                </label>
                                <br>
                                <div class="input-button-group">
                                    <ng-select id="holders-search-field" [items]="centralizationReportsList" [allowClear]="true" placeholder="Type a Share name or ISIN" [formControl]="searchForm.controls['search']" mltag="txt_typeasharenameorisin"></ng-select>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                <div class="hr-line-dashed"></div>

                <!--<ng-container *ngIf="id === 0">-->
                <!--&lt;!&ndash; list tab. &ndash;&gt;-->
                <!--<ng-container *ngTemplateOutlet="staticList">-->

                <!--</ng-container>-->
                <!--</ng-container>-->

                <!--<ng-container *ngIf="id > 0">-->
                <ng-container>
                    <!-- Create new tab -->
                    <ng-container *ngTemplateOutlet="dynamicView; context: {'tabid': id}">

                    </ng-container>
                </ng-container>
            </clr-tab-content>
        </clr-tab>
    </clr-tabs>

    <!-- Orders Data Table. -->
    <ng-template #dynamicView let-tabid="tabid">
        <div class="panel-body">

            <form [formGroup]="filterForm" id="search-share-form">

                <table style="width: 100%;" class="tableShareDetails">
                    <tbody>
                    <tr>
                        <td [ngStyle]="{'width': '40%'}">
                            <div class="form-group">
                                <label>
                                    <span><span mltag="txt_fundname">Fund name</span>:</span>
                                </label>
                                <div>
                                    <span class="readonly-field">{{baseCentralizationHistory.fundName}}</span>
                                </div>
                            </div>
                        </td>
                        <td [ngStyle]="{'width': '40%'}">
                            <div class="form-group">
                                <label>
                                    <span><span mltag="txt_umbrellafund">Umbrella fund</span>:</span>
                                </label>
                                <div>
                                    <span class="readonly-field">{{baseCentralizationHistory.umbrellaFundName}}</span>
                                </div>
                            </div>
                        </td>
                        <td [ngStyle]="{'width': '20%'}">
                            <div class="form-group">
                                <label>
                                    <span><span mltag="txt_currency">Currency</span>:</span>
                                </label>
                                <div>
                                    <span class="readonly-field">{{showCurrency(baseCentralizationHistory.shareClassCurrency)}}</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <h3 class="mb-1">
                    <span>Please choose the NAV dates for which you would like  to see this share's centralisation history</span>
                </h3>

                <table style="width: 100%;" class="tableShareDetails">
                    <tbody>
                    <tr>
                        <td style="width: 400px;">
                            <div class="form-group">
                                <label for="perdiod-search-field">
                                    <span><span mltag="txt_chooseaperiod">Choose a period</span>:</span>
                                </label>
                                <div class="input-button-group">
                                    <ng-select id="perdiod-search-field" [items]="periodList" name="top" [allowClear]="true" placeholder="Select" [formControl]="filterForm.controls['period']" mltag="txt_select"></ng-select>
                                </div>
                            </div>
                        </td>
                        <td style="width: 30px; padding: 0;">
                            <div class="form-group">
                                <label>
                                    <span mltag="txt_or">or</span>
                                </label>
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label for="search-date-from">
                                    <span><span mltag="txt_datefrom">Date from</span>:</span>
                                </label>
                                <div class="input-group date-pick-wrapper">
                                    <span class="fa fa-calendar" aria-hidden="true"></span>
                                    <input id="search-date-from" [(ngModel)]="dateFrom" formControlName="dateFrom" [disabled]="hideCalendars" [dpDayPicker]="configDate" placeholder="Choose a date" mode="day" theme="dp-material" mltag="txt_chooseadate">
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label for="search-date-to">
                                    <span><span mltag="txt_dateto">Date to</span>:</span>
                                </label>
                                <div class="input-group date-pick-wrapper">
                                    <span class="fa fa-calendar" aria-hidden="true"></span>
                                    <input id="search-date-to" [(ngModel)]="dateTo" formControlName="dateTo" [disabled]="hideCalendars" [dpDayPicker]="configDate" placeholder="Choose a date" mode="day" theme="dp-material" mltag="txt_chooseadate">
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="text-right">
                                <button id="export-centralization-btn" type="button" class="btn btn-success" style="max-width: none !important" (click)="exportAllHistory()">Export Centralisation history for these dates</button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="form-horizontal">
                    <div class="form-group">
                        <label>
                            <b><span><span mltag="txt_youcanclickoneachlinetomoreinf002b2eca34">You can click on each line to more information unfold</span></span></b>
                        </label>
                    </div>
                </div>
            </form>

            <clr-datagrid class="expandable" clrDgSortIcon #ordersDataGrid>
                <clr-dg-column [clrDgField]="'navDate'" clrDgSortIcon clrDgSortNoSearch>
                    <span mltag="txt_navdate">NAV date</span> <span class="column-label"></span>
                </clr-dg-column>
                <clr-dg-column [clrDgField]="'nav'" clrDgSortIcon clrDgSortNoSearch>
                    <span mltag="txt_nav">NAV</span> <span class="column-label"></span>
                </clr-dg-column>
                <clr-dg-column [clrDgField]="'aum'" clrDgSortIcon clrDgSortNoSearch>
                    <span mltag="txt_aum">AUM</span> <span class="column-label"></span>
                </clr-dg-column>
                <clr-dg-column [clrDgField]="'netPosition'" clrDgSortIcon clrDgSortNoSearch>
                    <span>Net Amount (CCY)</span> <span class="column-label"></span>
                </clr-dg-column>
                <clr-dg-column [clrDgField]="'netPositionPercentage'" clrDgSortIcon clrDgSortNoSearch>
                    <span>Net Amount (% AUM)</span> <span class="column-label"></span>
                </clr-dg-column>
                <!--ACTIONS-->
                <clr-dg-column><span mltag="txt_viewcorrespondingorderspage">View corresponding orders page?</span>
                </clr-dg-column>
                <clr-dg-column><span mltag="txt_downloadcsvreport">Download csv report?</span></clr-dg-column>

                <clr-dg-row *clrDgItems="let data of centralizationHistory">
                    <clr-dg-cell>
                        {{getOnlyDate(data.navDate)}}
                    </clr-dg-cell>
                    <clr-dg-cell>
                        {{data.latestNav | moneyValue: 2}}
                    </clr-dg-cell>
                    <clr-dg-cell>
                        {{data.aum | moneyValue: 5 }}
                    </clr-dg-cell>
                    <clr-dg-cell>
                        {{data.netPosition | moneyValue: 5 }}
                    </clr-dg-cell>
                    <clr-dg-cell>
                        {{data.netPositionPercentage | moneyValue: 2 }}%
                    </clr-dg-cell>
                    <clr-dg-cell>
                        <button id="view-order-page-btn-{{i}}" type="button" class="btn btn-info btn-sm" mltag="txt_vieworders" (click)="viewOrder(getOnlyDate(data.cutoffDate))">View Orders</button>
                    </clr-dg-cell>
                    <clr-dg-cell>
                        <button id="download-order-btn-{{i}}" type="button" class="btn btn-success btn-sm" mltag="txt_downloadorders" (click)="exportHistory(data)">Download Orders</button>
                    </clr-dg-cell>
                    <clr-dg-row-detail *clrIfExpanded>
                        <div class="additionalInfos">
                            <div class="row">
                                <div class="form-group col-sm-7">
                                    <table class="table table-noborder">
                                        <thead>
                                        <tr>
                                            <th></th>
                                            <th>Quantity</th>
                                            <th>Amount</th>
                                            <th>Cut-off Date</th>
                                            <th>Settlement Date</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td><b>Subscriptions</b></td>
                                            <td>{{data.subQuantity | moneyValue: 4 }}</td>
                                            <td>{{data.subAmount | moneyValue: 5 }}</td>
                                            <td>{{data.subCutoffDate}}</td>
                                            <td>{{data.subSettlementDate}}</td>
                                        </tr>
                                        <tr>
                                            <td><b>Redemptions</b></td>
                                            <td>{{data.redQuantity | moneyValue: 4 }}</td>
                                            <td>{{data.redAmount | moneyValue: 5 }}</td>
                                            <td>{{data.redCutoffDate}}</td>
                                            <td>{{data.redSettlementDate}}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </clr-dg-row-detail>
                </clr-dg-row>

                <clr-dg-footer>
                    {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
                    <clr-dg-pagination #pagination [clrDgPageSize]="20"></clr-dg-pagination>
                </clr-dg-footer>
            </clr-datagrid>

            <div class="text-center mt-1">
                <button id="holders-btn-back-list" type="button" class="btn btn-info" style="max-width: none !important" [routerLink]="['/reports/centralization']">Back to Centralisation</button>
            </div>
        </div>
    </ng-template>

</div>
