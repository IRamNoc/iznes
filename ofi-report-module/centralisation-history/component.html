<div class="header-breadcrumbs">
    <h1><i class="fa fa-calendar"></i>{{'Centralisation History' | translate}}

        <span *ngIf="baseCentralisationHistory.length > 0">{{baseCentralisationHistory.fundShareName}} - {{baseCentralisationHistory.isin}}</span>
    </h1>
</div>

<div class="wrapper wrapper-content">

    <clr-tabs *ngIf="tabsControl.length">
        <clr-tab *ngFor="let tabdata of tabsControl; let id = index">
            <button clrTabLink id="-{{id}}" [routerLink]="['/am-reports-section/centralisation-history', (id === 0) ? shareID :  id]">
                <i class="fa {{tabdata.title.icon}}"></i> {{tabdata.title.text}}
            </button>


            <clr-tab-content *clrIfActive="tabdata.active">
                <form [formGroup]="searchForm" id="search-orders-form">
                    <div class="form-horizontal">

                        <div class="row bordered">
                            <div class="form-group col-sm-6">
                                <label style="margin: 10px 0;">
                                    <span>{{'Please find below the Centralisation history for @baseCentralisationHistory.fundShareName@' | translate: {'baseCentralisationHistory.fundShareName': baseCentralisationHistory.fundShareName} }}</span>
                                </label>

                                <br>

                                <div class="input-button-group">
                                    <ng-select id="holders-search-field" [items]="centralisationReportsList" [allowClear]="true" [placeholder]="_translate.translate('Type a Share name or ISIN')" [formControl]="searchForm.controls['search']"></ng-select>
                                </div>
                            </div>
                        </div>


                    </div>
                </form>

                <div class="hr-line-dashed"></div>

                <!--<ng-container *ngIf="id === 0">-->
                <!--&lt;!&ndash; list tab. &ndash;&gt;-->
                <!--<ng-container *ngTemplateOutlet="staticList">-->

                <!--</ng-container>-->
                <!--</ng-container>-->

                <!--<ng-container *ngIf="id > 0">-->
                <ng-container>
                    <!-- Create new tab -->
                    <ng-container *ngTemplateOutlet="dynamicView; context: {'tabid': id}">

                    </ng-container>
                </ng-container>
            </clr-tab-content>
        </clr-tab>
    </clr-tabs>

    <!-- Orders Data Table. -->
    <ng-template #dynamicView let-tabid="tabid">
        <div class="panel-body">

            <form [formGroup]="filterForm" id="search-share-form">

                <table style="width: 100%;" class="tableShareDetails">
                    <tbody>
                    <tr>
                        <td [ngStyle]="{'width': '40%'}">
                            <div class="form-group">
                                <label>{{'Fund name:' | translate}}

                                </label>
                                <div>
                                    <span class="readonly-field">{{baseCentralisationHistory.fundName}}</span>
                                </div>
                            </div>
                        </td>
                        <td [ngStyle]="{'width': '40%'}">
                            <div class="form-group">
                                <label>{{'Umbrella fund:' | translate}}

                                </label>
                                <div>
                                    <span class="readonly-field">{{baseCentralisationHistory.umbrellaFundName}}</span>
                                </div>
                            </div>
                        </td>
                        <td [ngStyle]="{'width': '20%'}">
                            <div class="form-group">
                                <label>{{'Currency:' | translate}}

                                </label>
                                <div>
                                    <span class="readonly-field">{{showCurrency(baseCentralisationHistory.shareClassCurrency)}}</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <h3 class="mb-1">{{'Please choose the NAV dates for which you would like to see this share\'s centralisation history' | translate}}

                </h3>

                <table style="width: 100%;" class="tableShareDetails">
                    <tbody>
                    <tr>
                        <td style="width: 400px;">
                            <div class="form-group">
                                <label for="perdiod-search-field">{{'Choose a period:' | translate}}

                                </label>
                                <div class="input-button-group">
                                    <ng-select id="perdiod-search-field" [items]="periodList" name="top" [allowClear]="true" [placeholder]="_translate.translate('Select')" [formControl]="filterForm.controls['period']"></ng-select>
                                </div>
                            </div>
                        </td>
                        <td style="width: 30px; padding: 0;">
                            <div class="form-group">
                                <label>{{'or' | translate}}

                                </label>
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label for="search-date-from">{{'Date from:' | translate}}

                                </label>
                                <div class="input-group date-pick-wrapper">
                                    <span class="fa fa-calendar" aria-hidden="true"></span>
                                    <input id="search-date-from" [(ngModel)]="dateFrom" formControlName="dateFrom" [disabled]="hideCalendars" [dpDayPicker]="configDate" [placeholder]="_translate.translate('Choose a date')" mode="day" theme="dp-material">
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label for="search-date-to">{{'Date to:' | translate}}

                                </label>
                                <div class="input-group date-pick-wrapper">
                                    <span class="fa fa-calendar" aria-hidden="true"></span>
                                    <input id="search-date-to" [(ngModel)]="dateTo" formControlName="dateTo" [disabled]="hideCalendars" [dpDayPicker]="configDate" [placeholder]="_translate.translate('Choose a date')" mode="day" theme="dp-material">
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="text-right">
                                <button id="export-centralisation-btn" type="button" class="btn btn-success" style="max-width: none !important" (click)="exportAllHistory()">{{'Export Centralisation history for these dates' | translate}}</button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="form-horizontal">
                    <div class="form-group">
                        <label>
                            <b>{{'You can click on each line to more information unfold' | translate}}</b>
                        </label>
                    </div>
                </div>
            </form>

            <clr-datagrid class="expandable" clrDgSortIcon #ordersDataGrid>
                <clr-dg-column [clrDgField]="'navDate'" clrDgSortIcon clrDgSortNoSearch>{{'NAV date' | translate}}
                    <span class="column-label"></span>
                </clr-dg-column>
                <clr-dg-column [clrDgField]="'nav'" clrDgSortIcon clrDgSortNoSearch>{{'NAV' | translate}}
                    <span class="column-label"></span>
                </clr-dg-column>
                <clr-dg-column [clrDgField]="'aum'" clrDgSortIcon clrDgSortNoSearch>{{'AUM' | translate}}
                    <span class="column-label"></span>
                </clr-dg-column>
                <clr-dg-column [clrDgField]="'netPosition'" clrDgSortIcon clrDgSortNoSearch>{{'Net Amount (CCY)' | translate}}
                    <span class="column-label"></span>
                </clr-dg-column>
                <clr-dg-column [clrDgField]="'netPositionPercentage'" clrDgSortIcon clrDgSortNoSearch>{{'Net Amount (% AUM)' | translate}}
                    <span class="column-label"></span>
                </clr-dg-column>
                <!--ACTIONS-->
                <clr-dg-column>{{'View corresponding orders page?' | translate}}
                </clr-dg-column>
                <clr-dg-column>{{'Download csv report?' | translate}}</clr-dg-column>

                <clr-dg-row *clrDgItems="let data of centralisationHistory">
                    <clr-dg-cell>{{getOnlyDate(data.navDate)}}

                    </clr-dg-cell>
                    <clr-dg-cell>{{data.latestNav | moneyValue: 2}}

                    </clr-dg-cell>
                    <clr-dg-cell>{{data.aum | moneyValue: 5 }}

                    </clr-dg-cell>
                    <clr-dg-cell>{{data.netPosition | moneyValue: 5 }}

                    </clr-dg-cell>
                    <clr-dg-cell>{{data.netPositionPercentage | moneyValue: 2 }}{{'%' | translate}}

                    </clr-dg-cell>
                    <clr-dg-cell>
                        <button id="view-order-page-btn-{{i}}" type="button" class="btn btn-info btn-sm" (click)="viewOrder(getOnlyDate(data.navDate))">{{'View Orders' | translate}}</button>
                    </clr-dg-cell>
                    <clr-dg-cell>
                        <button id="download-order-btn-{{i}}" type="button" class="btn btn-success btn-sm" (click)="exportHistory(data)">{{'Download Orders' | translate}}</button>
                    </clr-dg-cell>
                    <clr-dg-row-detail *clrIfExpanded>
                        <div class="additionalInfos">
                            <div class="row">
                                <div class="form-group col-sm-7">
                                    <table class="table table-noborder">
                                        <thead>
                                        <tr>
                                            <th></th>
                                            <th>{{'Quantity' | translate}}</th>
                                            <th>{{'Amount' | translate}}</th>
                                            <th>{{'Cut-off Date' | translate}}</th>
                                            <th>{{'Settlement Date' | translate}}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td><b>{{'Subscriptions' | translate}}</b></td>
                                            <td>{{data.subQuantity | moneyValue: 4 }}</td>
                                            <td>{{data.subAmount | moneyValue: 5 }}</td>
                                            <td>{{data.subCutoffDate}}</td>
                                            <td>{{data.subSettlementDate}}</td>
                                        </tr>
                                        <tr>
                                            <td><b>{{'Redemptions' | translate}}</b></td>
                                            <td>{{data.redQuantity | moneyValue: 4 }}</td>
                                            <td>{{data.redAmount | moneyValue: 5 }}</td>
                                            <td>{{data.redCutoffDate}}</td>
                                            <td>{{data.redSettlementDate}}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </clr-dg-row-detail>
                </clr-dg-row>

                <clr-dg-footer>{{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}

                    <clr-dg-pagination #pagination [clrDgPageSize]="20"></clr-dg-pagination>
                </clr-dg-footer>
            </clr-datagrid>

            <div class="text-center mt-1">
                <button id="holders-btn-back-list" type="button" class="btn btn-info" style="max-width: none !important" [routerLink]="['/reports/select-centralisation']">{{'Back to Precentralisation' | translate}}</button>
            </div>
        </div>
    </ng-template>

</div>
