<div class="header-breadcrumbs">
    <h1>
        <i class="fa fa-umbrella"></i>
        <span *ngIf="!editForm; else editTitle" id="add-fund-title"> Add a New Umbrella Fund</span>

        <ng-template #editTitle>
            <span *ngIf="umbrellaFund" id="edit-fund-title">Umbrella fund: {{umbrellaFund[0].umbrellaFundName}}</span>
        </ng-template>
    </h1>
</div>

<clr-tabs>
    <clr-tab>
        <button clrTabLink id="tabUfButton">
            <span>Umbrella fund</span>
        </button>

        <clr-tab-content>
            <span *ngIf="editForm && umbrellaFund">
                Please find below all the information for the umbrella fund {{umbrellaFund[0].umbrellaFundName}}
            </span>

            <form [formGroup]="umbrellaFundForm" novalidate (ngSubmit)="save(umbrellaFundForm.value)">
                <section class="form-block">
                    <div class="well">
                        <!-- Panel header -->
                        <div class="row panel-header">
                            <div class="col-xs-6">
                                <a href="#"
                                   (click)="mainInformationOpen = !mainInformationOpen; $event.preventDefault();">
                                    <i class="fa fa-chevron-right" [class.rotate]="mainInformationOpen"></i>
                                    <h2> Main Information</h2>
                                </a>
                            </div>
                        </div>

                        <!-- Panel body -->
                        <div class="row panel-body" [class.hidden]="!mainInformationOpen">
                            <div class="form-group required-field col-sm-6">
                                <label for="uf_umbrellaFundName" class="control-label">Umbrella Fund Name</label>
                                <input type="text" id="uf_umbrellaFundName" formControlName="umbrellaFundName">
                                <div class="field-error" mltag="txt_thisfieldisrequired">This field is required</div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_lei" class="control-label">Legal Entity Identifier (LEI)</label>
                                <input type="text" id="uf_lei" formControlName="legalEntityIdentifier" maxlength="20">
                                <div class="field-error" mltag="txt_thisfieldisrequired">This field is required</div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_registerOffice" class="control-label">
                                    Name of the Registred Office of the Umbrella Fund
                                </label>
                                <input type="text" id="uf_registerOffice" formControlName="registerOffice">
                                <div class="field-error" mltag="txt_thisfieldisrequired">This field is required</div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_registerOfficeAddress" class="control-label">
                                    Address of the Registred Office of the Umbrella Fund
                                </label>
                                <input type="text" id="uf_registerOfficeAddress"
                                       formControlName="registerOfficeAddress">
                                <div class="field-error" mltag="txt_thisfieldisrequired">This field is required</div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_domicile" class="control-label">
                                    Umbrella Fund Domicile (country)
                                </label>

                                <ng-select id="uf_domicile"
                                           [items]="countries"
                                           [allowClear]="true"
                                           mltag="txt_selectCountry"
                                           placeholder="Select a country"
                                           formControlName="domicile">
                                </ng-select>

                                <div *ngIf="umbrellaFundForm.controls['domicile'].hasError('required') && umbrellaFundForm.controls['domicile'].touched"
                                     class="text-danger" mltag="txt_thisfieldisrequired">This field is required
                                </div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_umbrellaFundCreationDate" class="control-label">
                                    Umbrella Fund Creation Date
                                </label>

                                <div class="input-group date-pick-wrapper">
                                    <span class="fa fa-calendar" aria-hidden="true"></span>
                                    <input id="uf_umbrellaFundCreationDate"
                                           formControlName="umbrellaFundCreationDate" [dpDayPicker]="configDate"
                                           placeholder="Choose a date" mode="day" theme="dp-material"/>
                                </div>

                                <div *ngIf="umbrellaFundForm.controls['umbrellaFundCreationDate'].hasError('required') && umbrellaFundForm.controls['umbrellaFundCreationDate'].touched"
                                     class="text-danger" mltag="txt_thisfieldisrequired">This field is required
                                </div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_managementCompany" class="control-label">Management Company</label>
                                <ng-select id="uf_managementCompany"
                                           [items]="managementCompanyList"
                                           [allowClear]="true"
                                           mltag="txt_select" placeholder="Select"
                                           formControlName="managementCompanyID">
                                </ng-select>

                                <div *ngIf="umbrellaFundForm.controls['managementCompanyID'].hasError('required') && umbrellaFundForm.controls['managementCompanyID'].touched"
                                     class="text-danger" mltag="txt_thisfieldisrequired">This field is required
                                </div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_fundAdministrator" class="control-label">Fund Administrator</label>
                                <ng-select id="uf_fundAdministrator"
                                           [items]="fundAdminOptions"
                                           [allowClear]="true"
                                           mltag="txt_select"
                                           placeholder="Select"
                                           formControlName="fundAdministratorID">
                                </ng-select>

                                <div *ngIf="umbrellaFundForm.controls['fundAdministratorID'].hasError('required') && umbrellaFundForm.controls['fundAdministratorID'].touched"
                                     class="text-danger" mltag="txt_thisfieldisrequired">This field is required
                                </div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_custodian" class="control-label">Custodian Bank</label>
                                <ng-select id="uf_custodian"
                                           [items]="custodianBankOptions"
                                           [allowClear]="true" mltag="txt_select"
                                           placeholder="Select"
                                           formControlName="custodianBankID">
                                </ng-select>

                                <div *ngIf="umbrellaFundForm.controls['custodianBankID'].hasError('required') && umbrellaFundForm.controls['custodianBankID'].touched"
                                     class="text-danger" mltag="txt_thisfieldisrequired">This field is required
                                </div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_investmentManager" class="control-label">Investment Manager</label>
                                <ng-select id="uf_investmentManager"
                                           [items]="investmentManagerOptions"
                                           [allowClear]="true"
                                           mltag="txt_select" placeholder="Select"
                                           formControlName="investmentManagerID">
                                </ng-select>

                                <div *ngIf="umbrellaFundForm.controls['investmentManagerID'].hasError('required') && umbrellaFundForm.controls['investmentManagerID'].touched"
                                     class="text-danger" mltag="txt_thisfieldisrequired">This field is required
                                </div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_investmentAdvisor" class="control-label">Investment Advisor</label>
                                <ng-select id="uf_investmentAdvisor"
                                           [items]="investmentAdvisorOptions"
                                           [allowClear]="true"
                                           mltag="txt_select"
                                           placeholder="Select"
                                           formControlName="investmentAdvisorID">
                                </ng-select>

                                <div *ngIf="umbrellaFundForm.controls['investmentAdvisorID'].hasError('required') && umbrellaFundForm.controls['investmentAdvisorID'].touched"
                                     class="text-danger" mltag="txt_thisfieldisrequired">This field is required
                                </div>
                            </div>

                            <div class="form-group required-field col-sm-6">
                                <label for="uf_payingAgent" class="control-label">Paying Agent</label>
                                <ng-select id="uf_payingAgent"
                                           [items]="payingagentOptions"
                                           [allowClear]="true"
                                           mltag="txt_select"
                                           placeholder="Select"
                                           formControlName="payingAgentID">
                                </ng-select>

                                <div *ngIf="umbrellaFundForm.controls['payingAgentID'].hasError('required') && umbrellaFundForm.controls['payingAgentID'].touched"
                                     class="text-danger" mltag="txt_thisfieldisrequired">This field is required
                                </div>
                            </div>

                            <!-- TODO: Implement data once we have a proper definition of what these two fields must have -->
                            <div *ngIf="showTransferAgent" class="form-group required-field col-sm-6">
                                <label for="uf_transferAgent" class="control-label">Transfer Agent</label>
                                <input type="number" id="uf_transferAgent" formControlName="transferAgentID">
                                <div class="field-error" mltag="txt_thisfieldisrequired">This field is required</div>
                            </div>

                            <div *ngIf="showCentralizingAgent" class="form-group required-field col-sm-6">
                                <label for="uf_centralizingAgent" class="control-label">Centralising Agent</label>
                                <input type="number" id="uf_centralizingAgent" formControlName="centralisingAgentID">
                                <div class="field-error" mltag="txt_thisfieldisrequired">This field is required</div>
                            </div>

                            <!-- Leave it for the case for being able to display dropdowns' content -->
                            <div *ngIf="mainInformationOpen" [ngStyle]="{'height':'100px'}"></div>
                        </div>
                    </div>

                    <br>

                    <div class="well">
                        <!-- Panel header -->
                        <div class="row panel-header">
                            <div class="col-xs-6">
                                <a href="#"
                                   (click)="optionalInformationOpen = !optionalInformationOpen; $event.preventDefault();">
                                    <i class="fa fa-chevron-right" [class.rotate]="optionalInformationOpen"></i>
                                    <h2> Optional Information</h2>
                                </a>
                            </div>
                        </div>

                        <!-- Panel body -->
                        <div class="row panel-body" [class.hidden]="!optionalInformationOpen">
                            <div class="form-group col-sm-6">
                                <label for="uf_giin" class="control-label">
                                    Global Intermediary Identification Number (GIIN)
                                </label>
                                <input type="text" id="uf_giin" formControlName="giin" maxlength="19"/>
                            </div>

                            <div class="form-group col-sm-6">
                                <label for="uf_delegatedManagementCompany" class="control-label">
                                    Delegated Management Company
                                </label>

                                <ng-select id="uf_delegatedManagementCompany"
                                           [items]="managementCompanyList"
                                           [allowClear]="true"
                                           mltag="txt_select" placeholder="Select"
                                           formControlName="delegatedManagementCompanyID">
                                </ng-select>
                            </div>

                            <div class="form-group col-sm-6">
                                <label for="uf_auditor" class="control-label">Auditor</label>
                                <ng-select id="uf_auditor"
                                           [items]="auditorOptions"
                                           [allowClear]="true"
                                           mltag="txt_select"
                                           placeholder="Select"
                                           formControlName="auditorID">
                                </ng-select>
                            </div>

                            <div class="form-group col-sm-6">
                                <label for="uf_taxAuditor" class="control-label">Tax Auditor</label>
                                <ng-select id="uf_taxAuditor"
                                           [items]="taxAuditorOptions"
                                           [allowClear]="true"
                                           mltag="txt_select"
                                           placeholder="Select"
                                           formControlName="taxAuditorID">
                                </ng-select>
                            </div>

                            <div class="form-group col-sm-6">
                                <label for="uf_principalPromoter" class="control-label">Principal Promoter</label>
                                <ng-select id="uf_principalPromoter"
                                           [items]="principalPromoterOptions"
                                           [allowClear]="true"
                                           mltag="txt_select"
                                           placeholder="Select"
                                           formControlName="principlePromoterID">

                                </ng-select>
                            </div>

                            <div class="form-group col-sm-6">
                                <label for="uf_legalAdvisor" class="control-label">Legal Advisor</label>
                                <ng-select id="uf_legalAdvisor"
                                           [items]="legalAdvisorOptions"
                                           [allowClear]="true"
                                           mltag="txt_select"
                                           placeholder="Select"
                                           formControlName="legalAdvisorID">
                                </ng-select>
                            </div>

                            <div class="form-group col-sm-6">
                                <label for="uf_directors" class="control-label">Directors</label>
                                <input type="text" id="uf_directors" formControlName="directors">
                            </div>

                            <!-- Leave it for the case for being able to display dropdowns' content -->
                            <div *ngIf="optionalInformationOpen" [ngStyle]="{'height':'20px'}"></div>
                        </div>
                    </div>
                    <br>

                    <div class="form-group col-sm-6">
                        <button id="ufBtnResetForm"
                                type="button"
                                class="btn btn-info"
                                (click)="cancel()">
                            <div *ngIf="!editForm; else editCloseButton"><span mltag="txt_cancel">Cancel</span></div>
                            <ng-template #editCloseButton><span mltag="txt_close">Close</span></ng-template>
                        </button>

                        <button id="mcBtnSubmitForm"
                                type="submit"
                                class="btn btn-primary"
                                [disabled]="!umbrellaFundForm.valid">

                            <div *ngIf="!editForm; else editUfFBtSubmit">
                                <i class="fa fa-save"></i>
                                <span mltag="txt_save">Save</span>
                            </div>

                            <ng-template #editUfFBtSubmit>
                                <i class="fa fa-save"></i>
                                <span mltag="txt_update">Update</span>
                            </ng-template>
                        </button>
                    </div>
                </section>
            </form>
        </clr-tab-content>
    </clr-tab>
</clr-tabs>

<!--CUSTOM TEXT MODALS-->
<clr-modal [(clrModalOpen)]="showModal">
    <h3 class="modal-title text-success"><i class="fa fa-info-circle" aria-hidden="true"></i> {{modalTitle}}</h3>
    <div class="modal-body text-success text-center">
        <p>{{modalText}}</p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline" (click)="showModal = false" mltag="txt_close">Close</button>
    </div>
</clr-modal>

<!--CONFIRM MODALS-->
<clr-modal [(clrModalOpen)]="showConfirmModal">
    <h3 class="modal-title" mltag="txt_deletecurrentmanagementcompany">Deleting Management Company</h3>
    <div class="modal-body">
        <p mltag="txt_areyousure">Are you sure you want to delete:<br/>
            <strong>INSERT HERE</strong>
        </p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline" id="mcConfirmModalBtnYes" (click)="confirmModal(0)"
                mltag="txt_no">No
        </button>
        <button type="button" class="btn btn-primary" id="mcConfirmModalBtnNo" (click)="confirmModal(1)"
                mltag="txt_yes">Yes
        </button>
    </div>
</clr-modal>