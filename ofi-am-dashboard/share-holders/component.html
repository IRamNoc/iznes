<div class="header-breadcrumbs">
    <h1><i class="fa fa-sitemap"></i>{{'Recordkeeping:' | translate}}</h1>
</div>

<section class="wrapper wrapper-content">
    <clr-tabs *ngIf="tabsControl.length">
        <clr-tab *ngFor="let tabdata of tabsControl">
            <button clrTabLink id="{{tabdata.id}}" [routerLink]="[tabdata.link, (tabdata.id === 0) ? 'list' :  tabdata.id]">
                <i class="fa {{tabdata.title.icon}}"></i> {{tabdata.title.text}}
            </button>

            <clr-tab-content *clrIfActive="tabdata.active">
                <form [formGroup]="searchFundsForm" id="search-funds-orders-form" *ngIf="tabdata.type === 'funds'">
                    <div class="form-horizontal">
                        <div class="row ">
                            <div class="form-group col-sm-8">
                                <p>{{'Please select the fund on which you want to see the recordkeeping or export recordkeeping for all funds by clicking on the top right button.' | translate}}</p>
                                <label style="margin: 10px 0;">
                                    <b><span>{{'Fund Name:' | translate}}</span></b>
                                </label>

                                <div class="input-button-group">
                                    <ng-select id="holders-search-field" [items]="fundList" [allowClear]="true" [placeholder]="_translate.translate('Type a Fund Name or a share\'s ISIN')" [formControl]="searchFundsForm.controls['search']">
                                    </ng-select>
                                </div>
                            </div>
                            <div class="col-sm-4 text-right">
                                <button id="holders-funds-all-export-btn" type="button" class="btn btn-success" style="max-width: none !important" (click)="handleHoldersExportButtonClick()">{{'Export Recordkeeping for all funds' | translate}}</button>
                            </div>
                        </div>
                    </div>
                </form>

                <form [formGroup]="searchFundsForm" id="search-shares-orders-form" *ngIf="tabdata.type === 'shares'">
                    SHARES
                </form>

                <div class="hr-line-dashed"></div>

                <!--Holders funds static-->
                <ng-container *ngIf="tabdata.id === 0 && tabdata.type === 'funds'">
                    <ng-container *ngTemplateOutlet="staticFunds; context: {'data': tabdata.data, 'tabid': tabdata.id}"></ng-container>
                </ng-container>

                <!--Holders funds with ID-->
                <ng-container *ngIf="tabdata.id > 0 && tabdata.type === 'funds'">
                    <ng-container *ngTemplateOutlet="dynamicFunds; context: {'data': tabdata.data, 'tabid': tabdata.id}"></ng-container>
                </ng-container>

                <!--Holders funds static-->
                <ng-container *ngIf="tabdata.id === 0 && tabdata.type === 'shares'">
                    <ng-container *ngTemplateOutlet="staticShares; context: {'data': tabdata.data, 'tabid': tabdata.id}"></ng-container>
                </ng-container>

                <!--Holders funds with ID-->
                <ng-container *ngIf="tabdata.id > 0 && tabdata.type === 'shares'">
                    <ng-container *ngTemplateOutlet="dynamicShares; context: {'data': tabdata.data, 'tabid': tabdata.id}"></ng-container>
                </ng-container>

            </clr-tab-content>
        </clr-tab>
    </clr-tabs>

    <ng-template #staticFunds let-data="data">
        <div class="panel-body">
            <form [formGroup]="filtersFundsForm" id="filters-funds-orders-form">
                <div class="form-horizontal">
                    <div class="row ">
                        <div class="form-group col-sm-12">
                            <label>
                                <b>{{'Top holders of this fund:' | translate}}</b>
                            </label>
                            <div class="input-button-group">
                                <ng-select id="holders-fund-filter-top" [items]="holderFilters" [allowClear]="true" [placeholder]="_translate.translate('Top holders of this fund')" [formControl]="filtersFundsForm.controls['topholders']">
                                </ng-select>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-1">
                        <div class="form-group col-sm-8">
                            <div class="form-group col-sm-4">
                                <label>
                                    <b>{{'Number of holders' | translate}}</b>
                                </label>
                                <div>
                                    <span class="readonly-field">{{fundsNbHolders}}</span>
                                </div>
                            </div>
                            <div class="form-group col-sm-4">
                                <label>
                                    <b>{{'Fund AUM' | translate}}</b>
                                </label>
                                <div>
                                    <span class="readonly-field">{{fundsAUM | moneyValue:5}}</span>
                                </div>
                            </div>
                            <div class="form-group col-sm-4">
                                <label>
                                    <b>{{'CCY' | translate}}</b>
                                </label>
                                <div>
                                    <span class="readonly-field">{{fundsCCY}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4 text-right">
                            <button id="holders-funds-export-btn" type="button" class="mt-1 btn btn-success" style="max-width: none !important" (click)="handleHoldersExportButtonClick()">{{'Export Recordkeeping' | translate}}</button>
                        </div>
                    </div>
                </div>
            </form>

            <br>

            <clr-datagrid clrDgSortIcon #ordersDataGrid>
                <clr-dg-column>{{'Ranking' | translate}}</clr-dg-column>
                <clr-dg-column>{{'Investor' | translate}}</clr-dg-column>
                <clr-dg-column>{{'Portfolio' | translate}}</clr-dg-column>
                <clr-dg-column>{{'Asset (Fund CCY)' | translate}}</clr-dg-column>
                <clr-dg-column>{{'Ratio (%)' | translate}}</clr-dg-column>

                <clr-dg-row *clrDgItems="let data of data">
                    <clr-dg-cell>{{data.ranking}}</clr-dg-cell>
                    <clr-dg-cell>{{data.investor}}</clr-dg-cell>
                    <clr-dg-cell>{{data.portfolio}}</clr-dg-cell>
                    <clr-dg-cell>{{data.asset | moneyValue:5}}</clr-dg-cell>
                    <clr-dg-cell>{{data.ratio | moneyValue:2}}{{'%' | translate}}</clr-dg-cell>
                </clr-dg-row>

                <clr-dg-footer>
                    <clr-dg-pagination #pagination [clrDgPageSize]="10">
                        <!--{{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} of {{pagination.totalItems}}-->
                    </clr-dg-pagination>
                </clr-dg-footer>
            </clr-datagrid>
        </div>
    </ng-template>

</section>
