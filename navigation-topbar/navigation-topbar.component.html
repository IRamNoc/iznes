<header class="header-6">

    <div class="branding">
        <button (click)="controlMenu()"><i class="fa fa-bars" aria-hidden="true"></i></button>
        <a href="#/home" class="nav-link">
            <img src="{{topbarLogoUrl}}" style="height: 50%;" alt="Topbar logo">
        </a>
    </div>
    <form class="search" [formGroup]="searchForm" style="background-color: transparent !important">
        <!--<label for="search_input">-->
        <!--<input id="search_input" type="text" placeholder="{{ 'Search for keywords...' | translate }}'">-->
        <!--</label>-->
    </form>
    <div class="header-actions">

        <div class="user iznes" id="topBarMenu" appHighlight *ngIf="appConfig.platform === 'IZNES'">
            <img src="assets/images/male.png">
            <p>{{username}}</p>
            <div class="last-login">
                {{ 'Last' | translate }}: {{lastLogin}}
            </div>
        </div>

        <clr-dropdown class="user-profile" id="topBarMenu" appClicked *ngIf="appConfig.platform !== 'IZNES'">
            <div class="user" clrDropdownToggle>
                <img src="assets/images/male.png">
                <p>{{username}} <i class="fa fa-angle-down"></i></p>
                <div class="last-login">
                    {{ 'Last' | translate }}:&nbsp;{{lastLogin | datex: 'MMMM DD YYYY HH:mm'}}
                </div>
            </div>

            <div class="dropdown-menu">
                <a [routerLink]="['/account/my-account/detail']" id="topBarMyAccount" clrDropdownItem>{{ 'My Account' | translate }}</a>
            </div>
        </clr-dropdown>

        <blockchain-status-tracker *ngIf="appConfig.platform === 'OpenCSD'"></blockchain-status-tracker>

        <div class="wallet">
            <div class="decalWallet">
                <ng-select [allowClear]="false" [items]="walletSelectItems" (selected)="selected($event)" (removed)="removed($event)" [placeholder]="translate.translate('No wallet selected')" [formControl]="selectedWalletId" [multiple]="false" inlineLabel="Wallet" inlineLabelMlTag="txt_wallet">
                </ng-select>
            </div>
        </div>

        <div class="right-buttons">
            <div id="translation-report-button" appHighlight class="dropdown" *ngIf="!appConfig.production">
                <a (click)="getMissingTranslations()" class="nav-button dropdown-toggle messages-icon blink_me">
                    <clr-icon shape="warning-standard" class="icon text-warning"></clr-icon>
                    <!--style="stroke: orange"-->
                    <p class="text-warning">{{ 'Translations' | translate }}</p>
                </a>
            </div>
            <div class="dropdown" appActiveHeaderButton [url]="'/messages/inbox'">
                <a [routerLink]="['/messages']" class="nav-button dropdown-toggle messages-icon">
                    <clr-icon shape="email" class="icon" [ngClass]="hasMail"></clr-icon>
                    <p>{{ 'Messages' | translate }}</p>

                    <span *ngIf="unreadMessageCount > 0">{{unreadMessageCount}}</span>
                </a>
            </div>

            <clr-dropdown id="dropdown-user" appClicked appHighlight appActiveHeaderButton [url]="'/profile/my-information'">
                <div class="nav-button" clrDropdownToggle>
                    <clr-icon shape="user" class="icon"></clr-icon>
                    <p>{{ 'Profile' | translate }}</p>
                </div>

                <div class="dropdown-menu">
                    <a *ngFor="let item of profileMenu" [routerLink]="[item.router_link]" [id]="item.element_id" clrDropdownItem [attr.mltag]="item.label_txt">{{item.label}}</a>
                </div>
            </clr-dropdown>

            <clr-dropdown class="bottom-right" appClicked>
                <a class="nav-button" clrDropdownToggle id="dropdown-settings">
                    <clr-icon shape="cog" class="icon"></clr-icon>
                    <p>{{ 'Settings' | translate }}</p>
                </a>
                <div class="dropdown-menu" style="margin-right: -19px">
                    <a clrDropdownItem (click)="toggleSidebar.emit($event)" id="dropdown-btn-lang">{{ 'Language' | translate }}</a>
                    <!--<a [routerLink]="['/logout']" clrDropdownItem id="dropdown-btn-logout">{{ 'Log out' | translate }}</a>-->
                </div>
            </clr-dropdown>

            <div class="dropdown">
                <a [routerLink]="['/logout']" id="logout" class="nav-button dropdown-toggle messages-icon">
                    <clr-icon shape="logout" class="icon"></clr-icon>
                    <p>{{ 'Log out' | translate }}</p>
                </a>
            </div>
        </div>

        <button class="header-overflow-trigger" type="button">

        </button>
    </div>
</header>

<clr-modal [(clrModalOpen)]="showCountdownModal" [clrModalClosable]="false">
    <div class="modal-title">
        <i class="fa fa-exclamation-triangle modal-icon text-warning"></i>
        <h4 class="modal-title-text">
            <span >{{ 'Session expiring soon' | translate }}</span></h4>
    </div>
    <div class="modal-body">
        <p>{{ 'Your session will expire in' | translate }}
            <span class="text-warning">{{remainingSecond && remainingSecond}}</span> {{ 'seconds.' | translate }}

        </p>
        <p>{{ 'Press' | translate }}
            <span class="text-primary font-weight-bold">{{ 'continue' | translate}}</span> {{ 'to continue using this site.' | translate }}

        </p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="handleExtendSession()">
            <span>{{ 'Continue' | translate }}</span>
        </button>
    </div>
</clr-modal>

<clr-modal [(clrModalOpen)]="showMissingTranslations" [clrModalSize]="'lg'">
    <h3 class="modal-title">{{ 'Translations' | translate }}</h3>
    <div class="modal-body" style="overflow: auto; padding: 30px 50px;">
        <div class="switch-container">
            {{ 'Highlight' | translate }}:
            <label class="switch">
                <input type="checkbox" id="showHighlightTranslations" [(ngModel)]="showHighlightTranslations" (change)="doHighlight()">
                <span class="slider round"></span>
            </label>
        </div>
        <div *ngIf="missingTranslations.length > 0; else noNeedTranslation">
            <h3 class="text-center mb-1">{{ 'Need to translate' | translate }}</h3>
            <div *ngFor="let item of missingTranslations; let i = index">
                <a [routerLink]="item.from" (click)="showMissingTranslations = false">{{i + 1}}. {{item.translation}}</a>
            </div>
        </div>
        <ng-template #noNeedTranslation>
            <h3 class="text-center mb-1">{{ 'Need to translate' | translate }}</h3> - {{ 'Nothing' | translate }}

        </ng-template>
        <div *ngIf="responsesService.length > 0">
            <div *ngIf="missingTranslations.length > 0" class="hr-line-dashed"></div>
            <h3 class="text-center mb-1" [ngClass]="{'mt-1': missingTranslations.length > 0}">{{ 'Translations report' | translate }}</h3>
            <div *ngFor="let item of responsesService; let i = index">
                <span [ngClass]="item.response.ok ? 'text-success' : 'text-danger'">{{ '@i + 1@.' | translate: {'i + 1': i + 1} }}
                    <span *ngIf="item.response.ok" style="font-weight: bold;">({{ 'OK' | translate }}) - </span>
                    <span *ngIf="!item.response.ok" style="font-weight: bold;">({{ 'FAILED' | translate }}  - {{item.response.statusText}}) - </span>{{item.translation.translation}}
                </span>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button *ngIf="missingTranslations.length > 0" type="button" class="btn btn-success" [disabled]="isSaving" (click)="isSaving = true; generateTranslations()">{{ 'Generate translations (max @nbMaxTranslationsToProcess@ per click)' | translate: {'nbMaxTranslationsToProcess': nbMaxTranslationsToProcess} }}

        </button>
        <button type="button" class="btn btn-primary" (click)="showMissingTranslations = false">{{ 'Close' | translate }}</button>
    </div>
</clr-modal>

<clr-modal [clrModalOpen]="walletNodeDead | async" [clrModalClosable]="false">
    <div class="modal-title">
        <i class="fa fa-exclamation-triangle modal-icon text-warning"></i>
        <h4 class="modal-title-text">{{ 'Connection issues' | translate }} <i class="fa fa-plug"></i></h4>
    </div>
    <div class="modal-body tcenter">
        <p>{{ 'Your connection to the WalletNode has been lost. Please wait while we attempt to reconnect you.' | translate }}</p>
        <p>{{ 'Alternatively, you could try refreshing your browser.' | translate }}</p>
    </div>
    <div class="modal-footer">
    </div>
</clr-modal>
