node {
    timestamps {

            stage('Deploy Frontend to APIDev Environment'){
                node{
                    sh '''
              ssh root@apidev.iznes.io mv /var/www_setltestnet/ /var/www_setltestnet_$(date +%F-%H:%M) &&
              ssh root@apidev.iznes.io mkdir /var/www_setltestnet && 
              scp -pr /var/lib/jenkins/Deploy/dist/*  root@apidev.iznes.io:/var/www_setltestnet'''
                }
            }
            stage('Deploy Backend to APIDev Environment') {
                node {
                    sh '''
                            ssh root@apidev.iznes.io mv /var/phpapps/backend /var/phpapps/backend_$(date +%F-%H:%M) &&
                            ssh root@apidev.iznes.io mkdir /var/phpapps/backend && 
                            scp -pr /var/lib/jenkins/Deploy/backend/*  root@apidev.iznes.io:/var/phpapps/backend'''
                }
            }

            stage('Deploy French Fund Daemon to APIDev Environment') {
                node {
                    sh '''
                            ssh root@apidev.iznes.io mv /var/phpapps/frenchfunddaemon /var/phpapps/frenchfunddaemon_$(date +%F-%H:%M) &&
                            ssh root@apidev.iznes.io mkdir /var/phpapps/frenchfunddaemon && 
                            scp -pr /var/lib/jenkins/Deploy/ffdaemon/*  root@apidev.iznes.io:/var/phpapps/frenchfunddaemon'''
                }
            }

            stage ('Update Dependencies'){
                sh 'ssh -t root@apidev.iznes.io \'cd /var/phpapps/backend/ ; bash && sudo npm install\''
            }

            stage ('Restart Node Server'){
                sh 'ssh -t root@apidev.iznes.io \'cd /var/phpapps ; bash && sudo supervisorctl restart node_server\''
            }
    }
}
