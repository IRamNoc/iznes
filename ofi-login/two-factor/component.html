<!--TWO-FACTOR AUTHENTICATION-->
<div class="login-box" *ngIf="showModal && !showReset" [@fadeIn]>
    <div class="top-bar">
        <div class="icon">
            <i class="icon-key"></i>
        </div>
        <h2>{{ 'Two-Factor Authentication' | translate }}</h2>
    </div>
    <div class="form-container">
        <div id="qr-code" *ngIf="qrCode">
            <div class="text-block">
                <p class="no-margin"><strong>{{ 'Scan the QR code using your Authenticator App' | translate }}</strong>
                </p>
            </div>
            <section class="form-block text-center">
                <img src="{{ qrCode }}" alt="Two-Factor Authentication Code">
            </section>
        </div>

        <form [formGroup]="authenticateQRForm" (ngSubmit)="authenticateQRCode()">
            <div class="form-group">
                <label class="required-field" for="two-factor-code">{{ 'Authentication Code' | translate }}</label>
                <input type="text"
                       id="two-factor-code"
                       class="text-center"
                       formControlName="qrCodeNumber"
                       maxlength="6"
                       minlength="6"
                       placeholder="{{ 'Enter your six digit authentication code' | translate }}">

                <div *ngIf="authenticateQRForm.controls.qrCodeNumber.hasError('required') && authenticateQRForm.controls.qrCodeNumber.touched"
                     class="field-error">{{ 'Field is required' | translate }}
                </div>
            </div>

            <div class="form-group">
                <button id="two-factor-cancel" class="btn btn-multi" type="button" (click)="modalCancelled.emit(true)">
                    {{ 'Cancel' | translate }}
                </button>
                <button id="two-factor-submit" type="submit" class="btn btn-primary btn-multi" [disabled]="!authenticateQRForm.valid">
                    Submit
                </button>
            </div>
        </form>
    </div>
</div>

<!--RESET TWO-FACTOR-->
<div class="login-box" *ngIf="showReset && !emailSent" [@fadeIn]>
    <div class="top-bar">
        <div class="icon">
            <i class="icon-key"></i>
        </div>
        <h2>{{ 'Reset Two-Factor' | translate }}</h2>
    </div>
    <div class="form-container">
        <form [formGroup]="forgottenTwoFactorForm" (ngSubmit)="sendForgottonTwoFactorEmail()">
            <div class="form-group">
                <label class="required-field" for="forgot-two-factor-email">{{ 'Email Address' | translate }}</label>
                <input id="forgot-two-factor-email"
                       type="text"
                       class="form-control"
                       formControlName="email"
                       size="45"
                       placeholder="{{ 'Please enter your email address' | translate }}">
                <div *ngIf="forgottenTwoFactorForm.controls.email.hasError('required')"
                     class="field-error">
                    {{ 'Field is required' | translate }}
                </div>
                <div *ngIf="!forgottenTwoFactorForm.controls.email.valid && !forgottenTwoFactorForm.controls.email.hasError('required')"
                     class="field-error">
                    {{ 'Email not valid' | translate }}
                </div>
            </div>

            <div class="form-group">
                <button id="forgot-two-factor-cancel" class="btn btn-multi" type="button" (click)="closeTwoFactorModal()">
                    {{ 'Cancel' | translate }}
                </button>
                <button id="forgot-two-factor-submit" type="submit" class="btn btn-primary btn-multi" [disabled]="!forgottenTwoFactorForm.valid">
                    {{ 'Send' | translate }}
                </button>
            </div>
        </form>
    </div>
</div>

<!--EMAIL SENT-->
<div class="login-box" *ngIf="emailSent" [@fadeIn]>
    <div class="top-bar">
        <div class="icon">
            <i class="icon-key"></i>
        </div>
        <h2>{{ 'Reset Two-Factor' | translate }}</h2>
    </div>
    <div class="form-container">
        <div class="text-block">
            <p class="no-margin">{{ 'An email has been sent to' | translate }}:</p>
            <p class="no-margin text-center"><strong>{{emailUser}}</strong></p>
            <p>{{ 'This message will automatically close in @countdown@ seconds.' | translate: {'countdown': countdown} }}</p>
        </div>
        <div class="form-group">
            <button id="two-factor-email-sent-close" class="btn btn-margin" type="button" (click)="closeTwoFactorModal()">
                {{ 'Close' | translate }}
            </button>
        </div>
    </div>
</div>

<!--RESET INSTRUCTIONS-->
<div class="login-box" *ngIf="showResetInstruction" [@fadeIn]>
    <div class="top-bar">
        <div class="icon">
            <i class="icon-key"></i>
        </div>
        <h2>{{ 'Reset Two-Factor Authentication' | translate }}</h2>
    </div>
    <div class="form-container">
        <div class="text-block">
            <p class="no-margin">{{ 'To complete the reset of your Two-Factor Authentication, please login and then re-scan the QR code using your Authenticator App.' | translate }}</p>
        </div>
        <div class="form-group">
            <button id="go-to-login" class="btn" type="button" (click)="showResetInstruction=false; this.modalCancelled.emit(true)">
                {{ 'Go to login' | translate }}
            </button>
        </div>
    </div>
    <ng-container *ngTemplateOutlet="stopViewChildErrors"></ng-container>
</div>

<ng-template #stopViewChildErrors>
    <span #usernameInput></span>
    <span #passwordInput></span>
</ng-template>