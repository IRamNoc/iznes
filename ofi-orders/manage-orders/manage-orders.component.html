<div class="header-breadcrumbs">
    <h1 id="manage-orders">
        <i class="fa fa-list-ul"></i>{{ 'Order Book - @connectedWalletName@' | translate: {'connectedWalletName': connectedWalletName} }}
    </h1>
</div>

<!--<button type="button" class="btn btn-info m-1" (click)="placeFakeOrder()">Place a fake Order</button>-->

<div class="wrapper wrapper-content">

    <clr-tabs *ngIf="tabsControl.length">
        <clr-tab *ngFor="let tabdata of tabsControl; let id = index">
            <button [style.display]="getDisplay()" clrTabLink id="-{{id}}" [routerLink]="(id === 0 ? ['/manage-orders'] : ['/manage-orders', tabdata.orderData.orderID])">
                <i class="fa {{tabdata.title.icon}}"></i> {{ tabdata.title.text | translate }}
                <i class="fa fa-times-circle text-warning" *ngIf="id > 0 && tabdata.active" id="orderCloseTabBtn_{{id}}" (click)="closeTab(id)" [ngStyle]="{'margin-left': '14px', 'font-size':'18px'}"></i>
            </button>
            <clr-tab-content *clrIfActive="tabdata.active">
                <ng-container *ngIf="id === 0">
                    <!-- Coupon list tab. -->
                    <ng-container *ngTemplateOutlet="staticOrdersList">
                    </ng-container>
                </ng-container>

                <ng-container *ngIf="id >= 1">
                    <!-- Create new tab -->
                    <ng-container *ngTemplateOutlet="dynamicViewOrder; context: {'orderData': tabdata.orderData, 'tabid': id}">
                    </ng-container>
                </ng-container>
            </clr-tab-content>
        </clr-tab>
    </clr-tabs>

    <!-- Orders Data Table. -->
    <ng-template #staticOrdersList>
        <div class="panel-body">

            <form [formGroup]="tabsControl[0].searchForm" id="search-orders-form" (keydown.enter)="$event.preventDefault()">
                <div *ngIf="!isImported" class="form-horizontal">
                    <div class="bordered">
                        <table style="width: 100%; border-spacing: 10px!important">
                            <tr>
                                <td width="20%">
                                    <div class="form-group">
                                        <label>{{ 'ISIN' | translate }}</label>
                                        <div class="input-button-group">
                                            <input
                                                id="orders-search-isin"
                                                [formControl]="tabsControl[0].searchForm.controls['isin']"
                                                name="search-sharename"
                                                type="text"
                                                [placeholder]="translation.translate('ISIN')"
                                                style="width: 100% !important">
                                        </div>
                                    </div>
                                </td>
                                <td width="20%">
                                    <div class="form-group">
                                        <label>{{ 'Fund Name' | translate }}</label>
                                        <div class="input-button-group">
                                            <input id="orders-search-fundname" 
                                                    [formControl]="tabsControl[0].searchForm.controls['fundname']" 
                                                    name="search-fundname"
                                                    type="text" 
                                                    [placeholder]="translation.translate('Fund Name')" style="width: 100% !important">
                                        </div>
                                    </div>
                                </td>
                                <td width="20%">
                                    <div class="form-group">
                                        <label>{{ 'Share Name' | translate }}</label>
                                        <div class="input-button-group">
                                            <input id="orders-search-sharename" [formControl]="tabsControl[0].searchForm.controls['sharename']" name="search-sharename"
                                                   type="text" [placeholder]="translation.translate('Share Name')" style="width: 100% !important">
                                        </div>
                                    </div>
                                </td>
                                <td width="20%">
                                    <div class="form-group">
                                        <label>{{ 'Status' | translate }}</label>
                                        <div>
                                            <ng-select
                                                id="orders-search-status"
                                                class="fluid-width"
                                                [active]="[orderStatuses[0]]"
                                                [items]="orderStatuses"
                                                [formControl]="tabsControl[0].searchForm.controls['status']"
                                                [placeholder]="translation.translate('Status')">
                                            </ng-select>
                                        </div>
                                    </div>
                                </td>
                                <td width="20%">
                                    <div class="form-group">
                                        <label>{{ 'Order Type' | translate }}</label>
                                        <div>
                                            <ng-select
                                                id="orders-search-type"
                                                class="fluid-width"
                                                [active]="[orderTypes[0]]"
                                                [items]="orderTypes"
                                                [formControl]="tabsControl[0].searchForm.controls['type']">
                                            </ng-select>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="row">
                        <div class="form-group col-sm-12">
                            <div class="well mb-1">
                                <!-- Panel header -->
                                <div class="row panel-header">
                                    <div class="col-xs-6">
                                        <a href="#" (click)="isOptionalFiltersVisible = !isOptionalFiltersVisible; $event.preventDefault();">

                                            <i class="fa fa-chevron-right" [class.rotate]="isOptionalFiltersVisible"></i>
                                            <h2>{{ 'Optional Filters' | translate }}</h2>
                                        </a>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="text-right">
                                            <button class="btn" style="margin-right: 10px;" (click)="searchFilters.clear()">
                                                <i class="fa fa-trash"></i> {{ 'Clear Filters' | translate }}
                                            </button>
                                            <button class="btn btn-success nomargin" (click)="exportOrders()">
                                                <i class="fa fa-download"></i> {{ 'Export Orders CSV' | translate }}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Panel body -->
                                <div class="panel-body" [class.hidden]="!isOptionalFiltersVisible">
                                    <div class="row">
                                        <div class="form-group col-sm-3">
                                            <label>{{ 'Order Ref' | translate}}

                                            </label>
                                            <div class="input-button-group">
                                                <input id="orders-search-orderid" 
                                                        [formControl]="tabsControl[0].searchForm.controls['orderID']" 
                                                        name="search-sharename" 
                                                        type="number"
                                                        [placeholder]="translation.translate('Order ID')" style="width: 100% !important">
                                            </div>
                                        </div>
                                        <ng-container *ngIf="isIznesAdmin">
                                            <div class="form-group col-sm-3">
                                                <label>{{ 'Asset Management Company' | translate}}

                                                </label>
                                                <div class="input-button-group">
                                                    <input id="orders-search-amcomp" 
                                                            [formControl]="tabsControl[0].searchForm.controls['assetManagementCompany']" 
                                                            name="search-amComp" type="text"
                                                            [placeholder]="translation.translate('Asset Management Company')" 
                                                            style="width: 100% !important">
                                                </div>
                                            </div>
                                            <div class="form-group col-sm-3">
                                                <label>{{ 'Investor' | translate }}

                                                </label>
                                                <div class="input-button-group">
                                                    <input id="orders-search-investor" 
                                                            [formControl]="tabsControl[0].searchForm.controls['investorCompanyName']" 
                                                            name="search-investor" 
                                                            type="text"
                                                            [placeholder]="translation.translate('Investor')" style="width: 100% !important">
                                                </div>
                                            </div>
                                            <div class="form-group col-sm-3">
                                                <label>{{ 'Portfolio' | translate }}

                                                </label>
                                                <div class="input-button-group">
                                                    <input id="orders-search-portfolio" 
                                                            [formControl]="tabsControl[0].searchForm.controls['portfolioLabel']" 
                                                            name="search-portfolio" 
                                                            type="text"
                                                            [placeholder]="translation.translate('Portfolio')" style="width: 100% !important">
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-sm-3">
                                            <label>{{ 'Date Type' | translate }}</label>
                                            <div>
                                                <ng-select id="orders-search-date-types" 
                                                            class="fluid-width" 
                                                            [active]="[dateTypes[2]]" 
                                                            [items]="dateTypes" 
                                                            [allowClear]="false"
                                                            [formControl]="tabsControl[0].searchForm.controls['dateType']" 
                                                            [placeholder]="translation.translate('Type')">
                                                </ng-select>
                                            </div>
                                        </div>
                                        <div class="form-group col-sm-3">
                                            <label for="orders-search-from-date">{{ 'From Date' | translate }}

                                            </label>
                                            <div class="input-group date-pick-wrapper">
                                                <span class="fa fa-calendar" aria-hidden="true"></span>
                                                <input id="orders-search-from-date" 
                                                        formControlName="fromDate" 
                                                        autocomplete="off" 
                                                        [dpDayPicker]="fromConfigDate" 
                                                        [placeholder]="translation.translate('Choose a date')"
                                                        mode="day" 
                                                        theme="dp-material">
                                            </div>
                                        </div>
                                        <div class="form-group col-sm-3">
                                            <label for="orders-search-to-date">{{ 'To Date' | translate }}

                                            </label>
                                            <div class="input-group date-pick-wrapper">
                                                <span class="fa fa-calendar" aria-hidden="true"></span>
                                                <input id="orders-search-to-date" 
                                                        formControlName="toDate" 
                                                        autocomplete="off" 
                                                        [dpDayPicker]="toConfigDate" 
                                                        [placeholder]="translation.translate('Choose a date')"
                                                        mode="day" 
                                                        theme="dp-material">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <clr-datagrid (clrDgRefresh)="refresh($event)" [clrDgLoading]="loading" clrDgSortIcon #ordersDataGrid>
                    <clr-dg-column [clrDgField]="'orderRef'" clrDgSortIcon clrDgSortNoSearch id="Order-REF">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Order Ref' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'orderType'" clrDgSortIcon clrDgSortNoSearch id="Order-Type">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Order Type' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'investor'" clrDgSortIcon clrDgSortNoSearch id="Order-Investor">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Investor' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column *ngIf="isIznesAdmin" [clrDgField]="'portfolio'" clrDgSortIcon clrDgSortNoSearch id="Order-Portfolio">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Portfolio' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'isin'" clrDgSortIcon clrDgSortNoSearch id="Order-ISIN">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'ISIN' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'shareName'" clrDgSortIcon clrDgSortNoSearch id="Order-Share-Name">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Share Name' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'assetManagementCompany'" clrDgSortIcon clrDgSortNoSearch id="Order-Asset-Manager-Company">
                        <ng-container *clrDgHideableColumn="{hidden: true}">{{ 'Asset Management Company' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'shareCurrency'" clrDgSortIcon clrDgSortNoSearch id="Order-Share-Currency">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Share Currency' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'quantity'" clrDgSortIcon clrDgSortNoSearch id="Order-Quantity" class="right">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Quantity' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'tradedBy'" clrDgSortIcon clrDgSortNoSearch id="Order-Traded-By">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Traded By' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'latestNAV'" clrDgSortIcon clrDgSortNoSearch id="Order-Latest-NAV" class="right">
                        <ng-container *clrDgHideableColumn="{hidden: true}">{{ 'Latest NAV' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'grossAmount'" clrDgSortIcon clrDgSortNoSearch id="Order-Trade-Amount" class="right">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Trade Amount' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'feesAmount'" clrDgSortIcon clrDgSortNoSearch id="Order-Fee-Amount" class="right">
                        <ng-container *clrDgHideableColumn="{hidden: true}">{{ 'Fees Amount' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'orderDate'" clrDgSortIcon clrDgSortNoSearch id="Order-Order-Date">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Order Date' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'cutOffDate'" clrDgSortIcon clrDgSortNoSearch id="Order-Cut-Off-Date">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Cut-off Date' | translate}}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'navDate'" clrDgSortIcon clrDgSortNoSearch id="Order-NAV-Date">
                        <ng-container *clrDgHideableColumn="{hidden: true}">{{ 'NAV Date' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'settlementDate'" clrDgSortIcon clrDgSortNoSearch id="Order-Settlement-Date">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Settlement Date' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <clr-dg-column [clrDgField]="'orderStatus'" clrDgSortIcon clrDgSortNoSearch id="Order-Status">
                        <ng-container *clrDgHideableColumn="{hidden: false}">{{ 'Status' | translate }}
                            <span class="column-label"></span>
                        </ng-container>
                    </clr-dg-column>
                    <!-- ACTIONS -->
                    <clr-dg-column *ngIf="!isIznesAdmin" id="Order-Action" class="right">
                        <span class="text-center">{{ 'Actions' | translate }}</span>
                    </clr-dg-column>

                    <clr-dg-row *ngFor="let order of ordersList; let i = index" clrDgRowClickable>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- orderRef -->
                            {{ getOrderRef(order.orderID) }}
                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- orderType -->
                            <span>{{ getOrderTypeString(order) }}</span>
                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- investor {{showInvestor(order)}} -->{{order.investorCompanyName}}
                        </clr-dg-cell>
                        <clr-dg-cell *ngIf="isIznesAdmin" (click)="buildLink(order, $event)">
                            {{order.label}}
                        </clr-dg-cell>
                        <clr-dg-cell *ngIf="isInvestorUser">
                            <!-- isin -->
                            <button
                                class="btn btn-link btn-sm"
                                [routerLink]="['/' + getLinkRoute() + '/product-characteristic', order.isin]"
                            >{{order.isin}}
                            </button>
                        </clr-dg-cell>
                        <clr-dg-cell *ngIf="!isInvestorUser" (click)="buildLink(order, $event)">
                            <!-- isin -->
                            {{order.isin}}
                        </clr-dg-cell>
                        <clr-dg-cell *ngIf="isInvestorUser">
                            <!-- shareName -->
                            <button
                                class="btn btn-link btn-sm"
                                [routerLink]="['/' + getLinkRoute() + '/product-characteristic', order.isin]">
                                {{order.fundShareName}}
                            </button>
                        </clr-dg-cell>
                        <clr-dg-cell *ngIf="!isInvestorUser" (click)="buildLink(order, $event)">
                            <!-- shareName -->
                            {{order.fundShareName}}
                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- assetManagementCompany -->{{order.amCompanyName}}

                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- shareCurrency -->{{ showCurrency(order) }}

                        </clr-dg-cell>
                        <clr-dg-cell class="right" (click)="buildLink(order, $event)">
                            <!-- quantity -->{{ order.quantity | moneyValue: 5 }}

                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- byAmountOrQuantity -->
                            <span *ngIf="order.byAmountOrQuantity === 1">
                                {{ 'Quantity' | translate }}
                            </span>

                            <span *ngIf="order.byAmountOrQuantity === 2">
                                {{ 'Amount' | translate }}
                            </span>
                        </clr-dg-cell>
                        <clr-dg-cell class="right" (click)="buildLink(order, $event)">
                            <!-- latestNAV -->{{ order.price | moneyValue: 4 }}

                        </clr-dg-cell>
                        <clr-dg-cell class="right" (click)="buildLink(order, $event)">
                            <!-- grossAmount -->{{ order.amountWithCost | moneyValue: 2 }}

                        </clr-dg-cell>
                        <clr-dg-cell class="right" (click)="buildLink(order, $event)">
                            <!-- feesAmount -->{{ order.fee | moneyValue: 2 }}

                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- orderDate -->{{ getDateTime(order.orderDate) }}

                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- cutOffDate -->{{ getDateTime(order.cutoffDate) }}

                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- NAVDate -->{{ getOnlyDate(order.valuationDate) }}

                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <!-- settlementDate -->{{ getOnlyDate(order.settlementDate) }}

                        </clr-dg-cell>
                        <clr-dg-cell (click)="buildLink(order, $event)">
                            <span *ngIf="order.orderStatus == 1" class="label label-warning">{{ 'Initiated' | translate }}

                            </span>
                            <span *ngIf="order.orderStatus == 2" class="label label-info">{{ 'Waiting NAV' | translate }}

                            </span>
                            <span *ngIf="order.orderStatus == 3" class="label label-info">{{ 'Waiting settlement' | translate }}

                            </span>
                            <span *ngIf="order.orderStatus == 4 && order.orderUnpaid == false" class="label label-error">{{ 'Unpaid' | translate }}

                            </span>
                            <span *ngIf="order.orderStatus == 4 && order.orderUnpaid == true" class="label label-info">{{ 'Waiting settlement' | translate }}

                            </span>
                            <span *ngIf="order.orderStatus == -1" class="label label-success">{{ 'Settled' | translate }}

                            </span>
                            <span *ngIf="order.orderStatus == 0" class="label label-error">{{ 'Cancelled' | translate }}

                            </span>
                        </clr-dg-cell>
                        <clr-dg-cell *ngIf="!isIznesAdmin" [ngSwitch]="order.orderStatus" class="right">
                            <!--&lt;!&ndash; Actions &ndash;&gt;-->
                            <!--<button type="button" *ngIf="order.orderStatus == 1; else cancelDisabled" (click)="cancelOrder(i)" class="btn btn-sm btn-danger" mltag="txt_cancel">Cancel</button>-->
                            <!--<ng-template #cancelDisabled>-->
                            <!--<button type="button" class="btn btn-sm btn-info" disabled mltag="txt_cancel">Cancel</button>-->
                            <!--</ng-template>-->

                            <button type="button" class="btn btn-sm btn-danger" (click)="cancelOrder(i)" *ngSwitchCase="1">{{ 'Cancel' | translate }}</button>
                            <ng-container *ngSwitchCase="4">
                                <button type="button" *ngIf="isInvestorUser" class="btn btn-sm btn-info" disabled>{{ 'Cancel' | translate }}</button>
                                <button type="button" *ngIf="!isInvestorUser" class="btn btn-sm btn-primary" (click)="settleOrder(i)">{{ 'Settle' | translate }}</button>
                            </ng-container>
                            <button type="button" class="btn btn-sm btn-info" disabled *ngSwitchDefault> {{ 'Cancel' | translate }}</button>

                        </clr-dg-cell>
                        <clr-dg-row-detail *clrIfExpanded>
                            <div class="additionalInfos">
                                <div class="row">
                                    <div class="form-group col-sm-3">
                                        <table>
                                            <tbody>
                                            <tr>
                                                <td>
                                                    <b>{{ 'Asset Management Company' | translate }}</b>
                                                </td>
                                                <td>{{order.amCompanyName}}</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <table>
                                            <tbody>
                                            <tr>
                                                <td>
                                                    <b>{{ 'Latest NAV' | translate }}</b>
                                                </td>
                                                <td [class]="getPriceStatusCss(order)">{{order.price | moneyValue: 2}}</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <table>
                                            <tbody>
                                            <tr>
                                                <td>
                                                    <b>{{ 'Fees Amount' | translate }}</b>
                                                </td>
                                                <td>{{ order.fee | moneyValue: 2 }}</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <table>
                                            <tbody>
                                            <tr>
                                                <td>
                                                    <b>{{' NAV Date' | translate }}</b>
                                                </td>
                                                <td>{{getOnlyDate(order.valuationDate)}}</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </clr-dg-row-detail>
                    </clr-dg-row>

                    <clr-dg-footer>
                        <!-- Optional customization of hide/show columns toggle -->
                        <clr-dg-column-toggle>
                            <clr-dg-column-toggle-title>{{ 'Show/Hide Fields:' | translate }}

                            </clr-dg-column-toggle-title>
                            <!--<clr-dg-column-toggle-button clrType="selectAll">-->
                            <!--<button type="button" class="btn btn-primary">-->
                            <!--Select All-->
                            <!--</button>-->
                            <!--</clr-dg-column-toggle-button>-->
                            <clr-dg-column-toggle-button clrType="ok">
                                <button type="button" class="btn btn-primary" style="padding:0 20px">
                                    <clr-icon shape="check"></clr-icon>
                                </button>
                            </clr-dg-column-toggle-button>
                        </clr-dg-column-toggle>
                        <!--{{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}-->
                        <clr-dg-pagination #pagination [clrDgPageSize]="itemPerPage" [clrDgLastPage]="lastPage"></clr-dg-pagination>
                    </clr-dg-footer>
                </clr-datagrid>
            </form>
        </div>
    </ng-template>

    <!-- Orders Data Table. -->
    <ng-template #dynamicViewOrder let-orderData="orderData" let-tabid="tabid">
        <div class="panel-body">

            <!--<div class="m-1">{{orderData | json}}</div>-->
            <!--<div class="m-1">{{fundShare | json}}</div>-->

            <div *ngIf="userType != 46" class="well mb-1">
                <!-- Panel header -->
                <div class="row panel-header">
                    <div class="col-xs-6">
                        <a href="#" (click)="clientInformation  = !clientInformation ; $event.preventDefault();">
                            <i class="fa fa-chevron-right" [class.rotate]="clientInformation "></i>
                            <h2>{{ 'Client Information' | translate }}</h2>
                        </a>
                    </div>
                </div>

                <!-- Panel body -->
                <div class="panel-body" [class.hidden]="!clientInformation">
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'Company Name' | translate }}

                            </label>
                            <div>
                                <span class="readonly-field">{{orderData.investorCompanyName}}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'Investor' | translate }}

                            </label>
                            <div>
                                <span class="readonly-field">{{showInvestor(orderData)}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="well ml-1">
                        <!-- Panel header -->
                        <div class="row panel-header">
                            <div class="col-xs-6">
                                <a href="#" (click)="clientDetailsInformation  = !clientDetailsInformation ; $event.preventDefault();">
                                    <i class="fa fa-chevron-right" [class.rotate]="clientDetailsInformation "></i>
                                    <h2>{{ 'Details' | translate }}</h2>
                                </a>
                            </div>
                        </div>

                        <!-- Panel body -->
                        <div class="panel-body" [class.hidden]="!clientDetailsInformation">
                            <div class="form-group col-sm-12">
                                <div class="row mb-1">
                                    <div class="form-group col-sm-6">
                                        <label>{{ 'First Name' | translate }}</label>
                                        <div>
                                            <span class="readonly-field">{{orderData.firstName}}</span>
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-6">
                                        <label>{{ 'Last Name' | translate }}</label>
                                        <div>
                                            <span class="readonly-field">{{orderData.lastName}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="well mb-1">
                <!-- Panel header -->
                <div class="row panel-header">
                    <div class="col-xs-6">
                        <a href="#" (click)="generalInvestmentInformation  = !generalInvestmentInformation ; $event.preventDefault();">
                            <i class="fa fa-chevron-right" [class.rotate]="generalInvestmentInformation"></i>
                            <h2>{{ 'General Investment Information' | translate }}</h2>
                        </a>
                    </div>
                </div>

                <!-- Panel body -->
                <div class="panel-body" [class.hidden]="!generalInvestmentInformation">
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'Asset Management Company' | translate }}

                            </label>
                            <div>
                                <span class="readonly-field">{{orderData.amCompanyName}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ '(Entry/Exit) Fees' | translate }}

                            </label>
                            <div>
                                <span class="readonly-field">{{ orderData.feePercentage | moneyValue : 2 }}{{ '%' | translate }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="well ml-1">
                        <!-- Panel header -->
                        <div class="row panel-header">
                            <div class="col-xs-6">
                                <a href="#" (click)="mifid  = !mifid ; $event.preventDefault();">
                                    <i class="fa fa-chevron-right" [class.rotate]="mifid "></i>
                                    <h2>{{ 'MIFID II Costs & Charges' | translate }}</h2>
                                </a>
                            </div>
                        </div>

                        <!-- Panel body -->
                        <div class="panel-body" [class.hidden]="!mifid">
                            <div class="form-group col-sm-12">
                                <div class="row mb-1">
                                    <div class="form-group col-sm-6">
                                        <label>{{' One-off Charges' | translate }}</label>
                                        <div>
                                            <span class="readonly-field">{{ fundShare.mifiidChargesOneOff | moneyValue: 2 }} {{ '%' | translate }}</span>
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-6">
                                        <label>{{ 'Ongoing Charges' | translate }}</label>
                                        <div>
                                            <span class="readonly-field">{{ fundShare.mifiidChargesOngoing | moneyValue: 2 }} {{ '%' | translate }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <div class="form-group col-sm-6">
                                        <label>{{'Costs related to transactions initiated' | translate}}</label>
                                        <div>
                                            <span class="readonly-field">{{ fundShare.mifiidTransactionCosts | moneyValue: 2 }} {{ '%' | translate }}</span>
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-6">
                                        <label>{{ 'Charges related to ancillary services' | translate }}</label>
                                        <div>
                                            <span class="readonly-field">{{ fundShare.mifiidServicesCosts | moneyValue: 2 }} {{ '%' | translate }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <div class="form-group col-sm-6">
                                        <label>{{ 'Incidental Costs' | translate }}</label>
                                        <div>
                                            <span class="readonly-field">{{ fundShare.mifiidIncidentalCosts | moneyValue: 2 }} {{ '%' | translate }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="well mb-1">
                <!-- Panel header -->
                <div class="row panel-header">
                    <div class="col-xs-6">
                        <a href="#" (click)="productInformation  = !productInformation ; $event.preventDefault();">
                            <i class="fa fa-chevron-right" [class.rotate]="productInformation "></i>
                            <h2>{{ 'Product Information' | translate }}</h2>
                        </a>
                    </div>
                </div>

                <!-- Panel body -->
                <div class="panel-body" [class.hidden]="!productInformation">
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'ISIN' | translate }}

                            </label>
                            <div>
                                <span class="readonly-field">{{orderData.isin}}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'Share Name' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{orderData.fundShareName}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'Asset Class' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{fundShare.shareClassCode}}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'SRRI' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{fundShare.keyFactOptionalData.srri}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'SRI' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{fundShare.keyFactOptionalData.sri}}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'Share Currency' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{showCurrency(orderData)}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'NAV' | translate }}</label>
                            <div>
                                <span class="readonly-field {{getPriceStatusCss(orderData)}}">{{ orderData.price | moneyValue: 2 }}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'NAV Date' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{getOnlyDate(orderData.valuationDate)}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'Decimalization' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{fundShare.decimalization}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="well mb-1">
                <!-- Panel header -->
                <div class="row panel-header">
                    <div class="col-xs-6">
                        <a href="#" (click)="datesInformation  = !datesInformation ; $event.preventDefault();">
                            <i class="fa fa-chevron-right" [class.rotate]="datesInformation "></i>
                            <h2>{{ 'Dates Information' | translate }}</h2>
                        </a>
                    </div>
                </div>

                <!-- Panel body -->
                <div class="panel-body" [class.hidden]="!datesInformation">
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'Order Date' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{ getDateTime(orderData.orderDate)}}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'Cut-off Date' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{getDateTime(orderData.cutoffDate)}} </span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'NAV Date' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{ getOnlyDate(orderData.valuationDate)}}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'Settlement Date' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{getOnlyDate(orderData.settlementDate)}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="well mb-1">
                <!-- Panel header -->
                <div class="row panel-header">
                    <div class="col-xs-6">
                        <a href="#" (click)="orderInformation  = !orderInformation ; $event.preventDefault();">
                            <i class="fa fa-chevron-right" [class.rotate]="orderInformation "></i>
                            <h2>{{ 'Order Information' | translate }}</h2>
                        </a>
                    </div>
                </div>

                <!-- Panel body -->
                <div class="panel-body" [class.hidden]="!orderInformation">
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'Order Reference' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{ getOrderRef(orderData.orderID)}}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'Order Type' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{getOrderTypeString(orderData)}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'Quantity' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{orderData.quantity | moneyValue: 5}}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'Amount' | translate }}</label>
                            <div>
                                <span class="readonly-field">{{orderData.amount | moneyValue: 2}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1">
                        <div class="form-group col-sm-6">
                            <label>{{ 'Fee Amount' | translate }}

                            </label>
                            <div>
                                <span class="readonly-field">{{orderData.fee | moneyValue: 2}}</span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label>{{ 'Net Amount' | translate }}

                            </label>
                            <div>
                                <span class="readonly-field">{{orderData.amountWithCost | moneyValue: 2 }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1" *ngIf="isSellBuyOrder(orderData)">
                        <div class="form-group col-sm-6" *ngIf="orderData.orderType == 3">
                            <label>{{ 'Related Redemption Order' | translate }}

                            </label>
                            <div>
                                <span><a class="text-danger btn-link" (click)="buildLink(orderData, $event, 'sellBuyLinkOrderID')">{{getOrderRef(orderData.sellBuyLinkOrderID)}}</a></span>
                            </div>
                        </div>
                        <div class="form-group col-sm-6" *ngIf="orderData.orderType == 4">
                            <label>{{ 'Related Subscription Order' | translate }}

                            </label>
                            <div>
                                <span><a class="text-success btn-link" (click)="buildLink(orderData, $event, 'sellBuyLinkOrderID')">{{getOrderRef(orderData.sellBuyLinkOrderID)}}</a></span>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-1">
                        <div class="form-group col-sm-12">
                            <label>{{ 'Comment' | translate }}

                            </label>
                            <div>
                                <textarea class="readonly-textarea" disabled>{{orderData.orderNote}}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div align="middle">
                <button class="btn btn-info" (click)="closeTab(tabid)">{{ 'Close' | translate }}</button>
            </div>
        </div>
    </ng-template>
</div>

<!-- Asset manager order cancel modal -->
<clr-modal [(clrModalOpen)]="isAmConfirmModalDisplayed" [clrModalClosable]="false">
    <h3 class="modal-title">{{amConfirmModal.title | translate}}</h3>

    <div class="modal-body">
        <div class="jaspero__dialog-icon">
            <div class="f-modal-alert">
                <div class="f-modal-icon f-modal-info-error scaleWarning">
                    <span class="f-modal-body pulseWarningInsRed"></span>
                    <span class="f-modal-dot pulseWarningInsRed"></span>
                </div>
            </div>
        </div>

        <div class="jaspero__dialog-content" [innerHtml]="translation.translate(amConfirmModal.body)"></div>

        <form>
            <section class="form-block">
                <div class="row">
                    <div class="form-group col-sm-12">
                        <textarea id="cancelModalTextArea" style="min-height: 80px" [placeholder]="translation.translate(amConfirmModal.placeholder)"
                                  [(ngModel)]="cancelModalMessage" [ngModelOptions]="{standalone: true}">
                        </textarea>
                    </div>
                </div>
            </section>
        </form>
    </div>

    <div class="modal-footer">
        <button id='cancelModalBackButton' type="button" class="btn btn-outline" (click)="handleAmModalBackButtonClick()">
            {{ 'Back' | translate }}
        </button>

        <button id='cancelModalConfirmButton' type="button" class="btn btn-danger cancel-modal-confirm-btn" (click)="handleAmModalConfirmButtonClick(amConfirmModal.targetedOrder)">
            {{ 'Confirm' | translate }}
        </button>
    </div>
</clr-modal>
