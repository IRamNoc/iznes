node() {
    timestamps {

        stage('Check Out Application Code') {

            checkout([$class                           : 'GitSCM', branches: [[name: '*/release']],
                      doGenerateSubmoduleConfigurations: false, extensions: [],
                      submoduleCfg                     : [], userRemoteConfigs:
                          [[credentialsId: '6afd5a8d-023a-49f6-ba58-4f6b35cf3023',
                            url          : 'git@si-nexus01.dev.setl.io:opencsd-rewrite/opencsd-frontend-clarity.git']]])
        }

        try {
            stage('Build & Unit Test') {
                sh '''yarn install &&
                        cd src &&
                        sass styles.scss:styles.css &&
                        cd ../ '''

            }
        } catch (err) {

            emailext attachLog: true,
                compressLog: true,

                recipientProviders: [culprits()],
                replyTo: 'no-reply@setl.io',
                subject: "Unit Tests for Job '${env.JOB_NAME}'- (${env.BUILD_NUMBER}) have FAILED",
                body: "Please go to ${env.BUILD_URL} for more details. "

            mail(to: 'bill.mackie@setl.io, neil.gentry@setl.io, jordan.miller@setl.io, mingrui.huang@setl.io, ollie.kett@setl.io',
                subject: "Unit tests For Job '${env.JOB_NAME}'- (${env.BUILD_NUMBER}) has FAILED",
                body: "Please go to ${env.BUILD_URL} for more details. ");

        }
        try {
            stage('Build Prod') {
                sh 'yarn build-prod --output-path iznes_release_dist; cp ./VERSION ./iznes_release_dist/'
            }
        } catch (err) {

            emailext attachLog: true,
                compressLog: true,

                recipientProviders: [culprits()],
                replyTo: 'no-reply@setl.io',
                subject: "Production Build for Job '${env.JOB_NAME}'- (${env.BUILD_NUMBER}) have FAILED",
                body: "Please go to ${env.BUILD_URL} for more details. "

            mail(to: 'bill.mackie@setl.io, neil.gentry@setl.io, jordan.miller@setl.io, mingrui.huang@setl.io, ollie.kett@setl.io',
                subject: "Production Build for Job '${env.JOB_NAME}'- (${env.BUILD_NUMBER}) has FAILED",
                body: "Please go to ${env.BUILD_URL} for more details. ");

        }

        stage('Copy code to deployment folder') {
            sh '''rm -rf /var/lib/jenkins/Deploy/iznes_release_dist &&
                        rsync -a ./iznes_release_dist /var/lib/jenkins/Deploy/'''

            sh 'php /var/lib/jenkins/build/tools/move-code.php opencsd-iznes release /var/lib/jenkins/Deploy/iznes_release_dist'

        }

    }
    stage('Clean Up') {
        deleteDir()
    }
}
